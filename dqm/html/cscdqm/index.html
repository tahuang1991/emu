<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en" dir="ltr" >
  <head>
    <title>EMU CSC Online DQM Results Browser</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <style type="text/css">
      body {
      color: #000000; 
      background-color: #8080FF;
      margin: 2px;
      font-family:Arial;
      overflow: auto;
      }
      a, A:link, a:visited, a:active, A:hover	{
      color: #000000; 
      text-decoration: none;		
      outline-style: none;			
      }
      fieldset {
      background-color: #ddd;	
      border-style: solid;
      border-width: 1px;
      border-color: black;
      margin: 2px;
      padding: 2px;
      overflow: auto;
      }
      legend {
      border-style: solid;
      border-width: 1px;		
      background-color:  #C0C0FF;				
      }
      legend:hover {
      background-color: white;
      }
      label {
      font-weight: bold;
      }
      table {		
      border-color: black;		
      background-color: #AFAFAF;			
      border-collapse: collapse;
      background-color: #bbb;
      border-width: 1px;
      border-spacing: 0px;
      border-style: solid;	
      margin: 1px;
      }
      tr, th, td {
      vertical-align: top;
      border: 1px solid black;
      }
      td, th {
      border: 1px solid black;
      font-size:8pt; ;
      padding: 0px;
      }
      div.tabs {
      float: none;
      }
      div.tabs ul {
      list-style: none;
      padding: 0;
      margin: 0;
      }
      div.tabs li {
      font-size: 12px;
      float: left;
      border: 1px solid;
      border-bottom-width: 0;
      margin: 0 0.5em 0 0;
      background-color: #9F9F9F;
      }
      div.tabs a {
      display: block;
      padding: 0 1em;
      }
      div.tabs #selected, #selected:active, #selected_runs, #selected_runs:active {
      font-weight: bold;
      position: relative;
      top: 1px;
      background-color: white;
      }
      div#report_entry_div {
      max-height: 100px;			
      overflow: auto;
      }
      div#tests_div 
      {		
      max-height: 500px;		
      max-width: 300px;
      overflow: auto;
      }
      div#runs_list
      {
      max-height: 132px;			
      overflow-x: hidden;
      overflow-y: scroll;
      }
      div#slideshow_div {
      max-height: 400px;
      overflow: auto;
      }
      div#log {
      max-height: 200px;
      overflow: auto;
      }
      table.log {
      border-collapse: collapse;
      background-color: #ccc;
      border-width: 1px;
      border-spacing: 0px;
      border-style: solid;
      margin: 2px;
      }
      table.log th {background-color: #AFAFFF; text-align: left; padding: 0 2px 0 2px;}
      table.log tr {border-style: solid; background-color:#E0E0E0;}
      td.log {font-size:8pt; font-family:Arial; padding: 0 2px 0 2px; border-style: solid;}	
      span#debug {color: black; font-weight: bold;}
      span#info  {color: green; font-weight: bold;}
      span#error {color: orange; font-weight: bold;}
      span#warn  {color: orange; font-weight: bold;}
      .SEVERITY_NONE {background-color: yellowgreen; font-weight: bold;}
      .SEVERITY_LOW_STAT {background-color: yellowgreen; font-weight: bold;}
      .SEVERITY_MINOR  {background-color: yellow; font-weight: bold;}
      .SEVERITY_TOLERABLE {background-color: lightpink; font-weight: bold;}
      .SEVERITY_SEVERE  {background-color: orange; font-weight: bold;}
      .SEVERITY_CRITICAL  {background-color: red; font-weight: bold;}
      .SEVERITY_REPEATING_PROBLEM {background-color: #9090FF; font-weight: bold;}
      .SEVERITY_KNOWN_PROBLEM {background-color: magenta; font-weight: bold;}
      .SEVERITY_NO_DATA {background-color: #8C8C8C; font-weight: bold;}
      .SEVERITY_FILTERED {background-color: #CCCCCC; font-weight: bold;}
      .RUN_TYPE_ONLINE {background-color: white; font-weight: bold;}
      .RUN_TYPE_UNKNOWN {background-color: #BBBBBB; }
      .RUN_TYPE_COSMICS {background-color: #8FBC8F; }
      .RUN_TYPE_BEAM {background-color: #E9967A; }
      .RUN_TYPE_LOWSTAT {background-color: #FFFACD; }
      li.sshow_list { font-size:8pt; font-family:Arial; margin: 0;}
      table.dqm_report {
      background-color: #F0F0F0;
      }
      a.winTitle {
      margin: 0;
      font-size: 12px;
      font-weight: bold;
      text-decoration: none;
      color: #000080;		
      }
      a.add_to_list {		
      font-weight: bold;
      color: green;
      background: white;
      }	
      a.remove_from_list {		
      font-weight: bold;
      color: red;
      background: white;
      }
      a.test_help, span.show_icon {		
      font-weight: bold;
      color: white;
      background: #50D050;
      }	
      table.runs_table, table.tests_table {
      width: 100%;
      border-collapse: collapse;
      background-color: #bbb;
      border-width: 1px;
      border-spacing: 0px;
      border-style: solid;	
      margin: 1px;
      }
      table.runs_table tr, td {text-align: left; white-space: nowrap;}
      table.runs_table th {padding: 0 0 0 4px; text-align: left; font-weight: bold; background-color: #AFAFFF; } 
      table.nodes_table tr, td {white-space: nowrap; }
      td.node_info {background-color: white; text-align: center; }
      #csctable_div, #hwtable_div, #runs_div, #tests_div, #csccounters_div,
      #local_runs, #global_runs, #online_runs, #ddutable_div, #report_div, #known_problems_div
      {
      padding: 1px;
      border-style: solid;
      border-width: 1px;
      border-color: black;
      background-color: white;
      clear: left;
      overflow:auto;
      }
      div#report_entry_div {
      max-height: 100px;			
      overflow: auto;
      }
      #csctable_div, #hwtable_div, #csccounters_div,#ddutable_div {
      float: left;
      }
      #hwtable_div, #csccounters_div, #ddutable_div, #report_div, #known_problems_div {
      max-height: 350px;
      }
      #csc_table {
      border-collapse: collapse;
      background-color: #bbb;
      border-width: 1px;
      border-spacing: 0px;
      border-style: solid;
      margin: 2px;
      }
      #csc_table td {
      text-align: center;
      }
      legend.t_hdr, a.test_hdr {
      font-size: 9pt;
      font-weight: bold;
      background-color: #ddd;
      }
      a.test_hdr2 {
      font-size: 8pt;
      font-weight: bold;
      background-color: #ddd;
      }
      td.hw_tr {font-size: 10pt; font-weight: bold; background-color: #ddd;}
      td.hw_td {background-color: white; text-align: center;}
      td.me_csc, td.me_ddu { width: 18px; background-color: #8C8C8C}
      td.me_type{ background-color: #ddd; font-weight: bold;  width: 40px;} 
      td.me, td.me_emu { background-color: #ddd; font-weight: bold; font-size:9pt; width: 50px; }	
      th.RunLink {padding: 0 0 0 4px; text-align: left; font-size:10pt;  font-weight: bold; background-color: #AFAFFF; } 
      td.node {width: 24px; background-color: white; text-align: center; }
      td.td_status {background-color: white; text-align: center}
      th.repScope {padding: 0 0 0 4px; text-align: left; font-size:10pt;  font-weight: bold; background-color: #AFAFFF; }
      th.repInfo {padding: 0 0 0 4px; text-align: left; font-size:10pt;  background-color: #AFAFAF; }
      table.page_layout {
      border-spacing: 2px;
      background-color: #6060FF;
      }
      table.page_layout tr, table.page_layout th, table.page_layout td {
      vertical-align: top;
      }
      table.page_layout_status {
      border-spacing: 2px;
      background-color: white;
      }
    </style>
    <script type="text/javascript">
      // var baseURL="http://cms-csc.web.cern.ch/cms-csc/DQM/DAQ/plots/merged/";
      var baseURL="";
      var getPlot="getPlot";
      var getRefPlot="getRefPlot";
      var TestsList="getTestsList";
      var CSCList="getCSCList";
      var NodesStatus="getNodesStatus";
      var CSCCounters="getCSCCounters";
      var controlDQM="controlDQM";
      var controlDisplay="controlDisplay";
      var getNodesHistory="getNodesHistory";
      
      // Maps
      var CSCMap="redir?url=csc_map.js";
      var DDUMap="redir?url=ddu_csc_map.js";
      var VMEMap="redir?url=vme_pc_map.js";
      var TestsMap="redir?url=tests_map.js";
      var KnownProblemsList="redir?url=known_problems.js";
      var NodesStatsFile="redir?url=stats.js";
      // var RunsList="redir?url=runs_list.js";
      var RunsList="getRunsList";
      
      // DQM Reports
      var TextReport="redir?url=dqm_report.txt";
      // var JSONReport="redir?url=dqm_report.js";
      var JSONReport="getDQMReport";
      var reportWindow = "";
      
      var imgFormat=".png";
      var RunNumber="Online";
      var RunName="Online";
      var RunStartTime = "??";
      var Folder="";
      var RunInfoIdx = -1;
      var Canvas="";
      var Scope="";
      var isFolderValid=false;
      var postfix = ".plots";
      
      var updateImageInterval=10000; 
      
      var minImageHeight=100;
      var maxImageHeight=1200;
      var minImageWidth=100;
      var maxImageWidth=1900;
      var imgHeight=600;
      var imgWidth=800;
      var imgSizeStep=40;
      
      var RUNS=false;	// list of Runs
      var TREE_RUNS=false; //  actually list of Tests/Canvases
      var CSCMAP=false;
      var CSC_LIST=false;
      var DDUMAP=false;
      var NODES_LIST=false;
      var KNOWN_PROBLEMS=false;
      var NODES_HISTORY=false;
      var fShowKnownProblems=true;
      
      var CSC_COUNTERS=false;
      var TESTS_MAP=false;
      var DQM_REPORT=false;
      var REF_DQM_REPORT=false;
      var NODES_SAVED=false;
      
      var Log=new Array();
      var logLevel="all";
      
      var isIE = false;
      
      var selectedObjectList=new Array();
      
      var testsShowLists = new Array();
      testsShowLists["Custom"] = new Array();
      var runsShowLists = new Array();
      runsShowLists["Custom"] = new Array();
      var foldersShowLists = new Array();
      foldersShowLists["Selected Only"] = new Array();
      foldersShowLists["All CSCs"] = new Array();
      // foldersShowLists["Custom"] = new Array();
      var folderSListIdx=0;
      var fOpenExternal=false;
      var loopFoldersFirst = true;
      var fAutoUpdatePlot = false;
      var fShowReference = false;
      var fCompareDDUs = false;
      var fMarkLowStatErrs = true;
      var selFolder="";
      var selNode="";
      var selRefRun="";
      
      var EMUs = new Array();
      var DDUs = new Array();
      var CSCs = new Array();
      
      
      var updateCounters = new Array();
      var NodesHistory = new Array();
      var histDepth=200;
      var numCSCs=0;
      var numDDUs=0;
      var getNodesListDelay=10;
      var getCSCListDelay=20;
      var totalDAQevents=0;
      var totalDQMevents=0;
      var totalCSCblocks=0;
      var totalDQMrate=0;
      var totalCSCrate=0;
      var selSeverityFilter="NONE";
      var all_nodes_status_window=false;
      var nodes_prev=false;
      
      var DQM_SEVERITY = 
      	[
      	{"name": "LOW_STAT", "color": "yellowgreen", "descr": "Not Enough Statistics to perform Quality Test. Wait for more events."},
      	{"name": "MINOR", "color": "yellow", "descr": "Minor Issue. Could be ignored."},
      	{"name": "TOLERABLE", "color": "lightpink", "descr": "Tolerable Issue. Check status periodically. Report if switched to higher severity level." },
      	{"name": "SEVERE", "color": "orange", "descr": "Severe Problem. Check status periodically. Report if switched to higher severity level"},
      	{"name": "CRITICAL", "color": "red", "descr": "Important Problem. Consult with CEO and Hardware Experts."},
      	{"name": "REPEATING_PROBLEM", "color": "#9090FF", "descr": "Repeating Problem wrt selected comparison Run."},
      	{"name": "KNOWN_PROBLEM", "color": "magenta", "descr": "Acknowledged by Expert Problem."},
      	{"name": "NO_DATA", "color": "#8C8C8C", "descr": "No Events data for DDU or CSC. Check with official disabled CSCs list."},
      	{"name": "FILTERED", "color": "#CCCCCC", "descr": "Problems are not shown because of applied filter."}
      	];
      
      var CSC_TYPES = [
      	['ME+',[
      		["ME+4/2", 36],
      		["ME+4/1", 18],
      		["ME+3/2", 36],
      		["ME+3/1", 18],
      		["ME+2/2", 36],
      		["ME+2/1", 18],
      		["ME+1/3", 36],
      		["ME+1/2", 36],
      		["ME+1/1", 36]]
      	],
      	['ME-',[["ME-1/1", 36],
      		["ME-1/2", 36],
      		["ME-1/3", 36],
      		["ME-2/1", 18],
      		["ME-2/2", 36],
      		["ME-3/1", 18],
      		["ME-3/2", 36],
      		["ME-4/1", 18],
      		["ME-4/2", 36]]
      	]
      ];
      
      var RUN_TYPES =
              [
              {"type": "UNKNOWN", "name": "Undefined", "color": "#AAAAAA;", "descr": "Unknown/Undefined run type"},
              {"type": "COSMICS", "name": "Cosmics", "color": "#8FBC8F", "descr": "Cosmics run"},
              {"type": "BEAM", "name": "Beam", "color": "#E9967A", "descr": "Beam collisions run" },
              {"type": "LOWSTAT", "name": "Low stats", "color": "#CCCCCC", "descr": "Low statistsics run"}
              ];
      
      
      function addPadding(num,count,pad)
      {
      	var numStr = num + '';
      	while(numStr.length < count) {
      	numStr = pad + numStr;
      	}
      	return numStr;
      }
      
      function printNodeStatusLegend()
      {
      	var out = "<table class='dqm_report'><tr>";
//	out+= "<td class='td_status'><input class='button' type='button' name='action' style='background-color: #90ff90; font: bold 8pt Arial;' value='Show All' onClick='return showAllNodesStatuses();' title='Click to show all EmuMonitors statuses'></td>";
        out += "<td><b>Status legend:</b></td>";
      	out += "<td><span style='background-color: #ffff90;'>Ready/Configured</span></td>";
      	out += "<td><span style='background-color: #90ff90;'>Enabled/Started</span></td>";
      	out += "<td><span style='background-color: #ff9090;'>Halted/Stopped</span></td>";
      	out += "<td><span style='background-color: white;'>Dead</span></td>";
      	out += "<td><span style='background-color: #C0C0C0;'>Disabled</span></td>";
      //	out += "<td><input class='button' type='button' name='action' style='background-color: #90ff90; font: bold 10px Arial;' value='Show All' onClick='return showAllNodesStatuses();' title='Click to show all EmuMonitors statuses'></td>";
      	
              out += "</tr></table>";
              return out;
      }
      
      function printReportLegend()
      {
      	var out = "<table class='dqm_report'><tr>";
      	out += "<td><b>Severity legend:</b> ";
      	for (var i=0; i<DQM_SEVERITY.length; i++) {
      		out += " <span title='"+DQM_SEVERITY[i].descr+"' class='SEVERITY_"+DQM_SEVERITY[i].name+"'>" + DQM_SEVERITY[i].name + "</span> ";
      	}
      	out += "</td></tr></table>";
      	return out; 
      }
      
      function loadPlot() {
      	// var imgurl = Folder+"/"+Canvas;
      	// var objname = Canvas.substr(Canvas.search("/"), Canvas.length);
      	var objname = Canvas.substr(0, Canvas.search(".png"));
      	if (objname.search("/") >=0) objname = objname.substr(objname.search("/")+1, objname.length);
      	var timestamp=new Date()
      	var imgurl=baseURL+getPlot+"?objectName="+objname+"&folder="+Folder+"&imageWidth="+imgWidth+"&imageHeight="+imgHeight+"&run="+RunName+"&timestamp="+timestamp.getTime();
      	var zoomimage=baseURL+getPlot+"?objectName="+objname+"&folder="+Folder+"&imageWidth="+1600+"&imageHeight="+1200+"&run="+RunName+"&timestamp="+timestamp.getTime();
      //	var ref_imgurl =baseURL+getRefPlot+"?folder="+Folder+"&plot="+Canvas;
      	var ref = "ref";
      	if (selRefRun && selRefRun!="noref") ref = selRefRun;
      	var ref_imgurl=baseURL+getPlot+"?objectName="+objname+"&folder="+Folder+"&imageWidth="+imgWidth+"&imageHeight="+imgHeight+"&run="+ref+"&timestamp="+timestamp.getTime();
      	var out = "";
      	var title = "Plots";
      	// addlog(Folder +"/"+objname, "info"); 
      			
      	
      	if (!isFolderValid) {
      			
      		// out += RunNumber+": Invalid folder - \""+Folder+"\"<hr>";
      	} else {
      		if ((parent.Folder != "") && (parent.Canvas != "") ) {
      			if ((Folder.search("EMU") >=0 && Scope == "EMU") || 
      				(Folder.search("DDU") >=0 && Scope == "DDU") || 
      				(Folder.search("CSC") >=0 && parent.Scope == "CSC")) {
      				// out += RunNumber+": \""+Folder+"/"+Canvas+"\"<hr>";				
      				title += ": " +RunName+"/"+Folder+"/"+Canvas;
      				// addlog(title, "info")
      				// out += "<a target=blank href=\'"+imgurl+"\'><IMAGE height='"+imgHeight+"' NAME='test' SRC='"+imgurl+"'></a>";
      				// dirtypop();				
      				if (fOpenExternal) {
      					try {
      						var generator=window.open('','name','height='+(imgHeight+90)+',width='+(imgWidth+40)+',resizable=no');						
      						if (window.focus) {generator.focus()} 
      						generator.resizeTo(imgWidth+20, imgHeight+90);
      						generator.document.write('<html><head><title>'+title+'</title>');
      						generator.document.write("<style>body {color: #000000; background-color: #9090FF;margin: 2px;font-family:Arial;	overflow: auto;}"+
      						"span.winTitle {	margin: 0;font-size: 12px;font-weight: bold;text-decoration: none;color: #000000;}"+
      						"fieldset {background-color: #ddd;	border-style: solid;border-width: 1px;border-color: black;margin: 2px;padding: 2px;}"+
      						"legend {border-style: solid;border-width: 1px;background-color:  #C0C0FF;}</style>");
      						generator.document.write('</head><body>');
      						generator.document.write("<fieldset><legend><span class='winTitle'>"+title+"</span></legend>");
      						generator.document.write("<img NAME='test' id='dqmplot' SRC='"+imgurl+"' >");
      						generator.document.write("</fieldset>");
      						// generator.document.write('<p><a href="javascript:self.close()">Close</a> the popup.</p>');
      						generator.document.write('</body></html>');
      						generator.document.close();
      						
      					  } 
      					  catch (exc){
      					}
      				} else {
      				    // out += "<div id='dqmplot_zoom' style='width:300px;height:300px;border:1px solid black;left:20px;top:20px;'></div> ";
      					out += "<a target=blank href=\'"+zoomimage+"\'><img id='dqmplot' src='"+imgurl+"' ></a>";
      				}
      				
      				
      					 /*document.getElementById("dqmplot_zoom"),  
      					150, 300,  
      					true  
      				);  */
      				
      				if (fShowReference) {
      					try {
      						var generator=window.open('','ref_name','height=640,width=800,resizable=true');
      						if (window.focus) {generator.focus()}
      						var ref_title = "Reference Plots: " +Folder+"/"+Canvas;
      						generator.document.write('<html><head><title>'+ref_title+'</title>');
      						generator.document.write("<style>body {color: #000000; background-color: #90FF90;margin: 2px;font-family:Arial;	overflow: auto;}"+
      						"span.winTitle {	margin: 0;font-size: 12px;font-weight: bold;text-decoration: none;color: #000000;}"+
      						"fieldset {background-color: #ddd;	border-style: solid;border-width: 1px;border-color: black;margin: 2px;padding: 2px;}"+
      						"legend {border-style: solid;border-width: 1px;background-color:  #C0FFC0;}</style>");
      						generator.document.write('</head><body>');
      						generator.document.write("<fieldset><legend><span class='winTitle'>"+ref_title+"</span></legend>");
      				/*		generator.document.write("<span style='color: #FF0000'><blink>Warning: These Reference Plots are not certified yet!!!</blink></span><br>"); */
      						generator.document.write("<IMAGE NAME='test' SRC='"+ref_imgurl+"'>");
      						generator.document.write("</fieldset>");
      						// generator.document.write('<p><a href="javascript:self.close()">Close</a> the popup.</p>');
      						generator.document.write('</body></html>');
      						generator.document.close();
      					} 
      					catch (exc){
      					}
      					
      				}
      				
      			}else {
      				addlog("Can not display '"+Canvas+"'. Selected canvas scope '"+Scope+"' and folder '"+Folder+"' logical sections mismatch", "warn");
      				// addlog("Invalid canvas: \""+RunNumber+"/"+Folder+"/"+Canvas, "error");
      				// out += "Invalid canvas: \""+Folder+"/"+Canvas+"\"<hr>";
      			} 
      		} 
      	}
      	var o_obj = document.getElementById("plots_div");
      	if (o_obj) o_obj.innerHTML = out;
      	o_obj = document.getElementById("plot_title");
      	if (o_obj) o_obj.innerHTML = title;
      	
      	return false;
      }
      
      function updatePlots() {
      	if (fAutoUpdatePlot) {
      		loadPlot();
      		
      		setTimeout('updatePlots()',updateImageInterval);
      	}
      }
      
      function showHide(id)
      {
         obj = document.getElementById(id);
         if (obj) {
      	if (obj.style.display == 'none') obj.style.display = '';
      	else obj.style.display = 'none';
         }
         return false;
      }
      
      function getTime()
      {
      	var t = new Date();
      	val = t.getDate()
      	date = (val<10)?'0'+val:val;
      	val = t.getMonth()+1;
      	month = (val<10)?'0'+val:val;
      	year = t.getFullYear();	
      	val = t.getHours();
      	hour = (val<10)?'0'+val:val;
      	val = t.getMinutes();
      	minute = (val<10)?'0'+val:val;
      	val = t.getSeconds();
      	sec = (val<10)?'0'+val:val;
      	time_str = date+"/"+month+"/"+year+" "+hour+":"+minute+":"+sec;
      	return time_str;
      }
      
      function addlog(message, level)
      {
      	if (Log) {
      		var entry = new Array();
      		entry[0] = getTime();
      		entry[1] = level;
      		entry[2] = message;
      		Log.push(entry);
      		showLog();
      	}
      }
      
      function showLog()
      {
      	var logd = document.getElementById("log");
      	if (Log && logd && !isIE) {
      		logd.style.display = "none";
      		logd.innerHTML = "";
      		var out = "<table class='log'>";
      		if (Log.length >0) 
      			out += "<tr><th>Date/Time</th><th>Level</th><th>Message</th></tr>";
      		
      		for (var i=Log.length-1; i>=0; i--) {
      			if (Log[i] && Log[i].length==3) {
      				level = Log[i][1];
      				if (level == logLevel || logLevel == "all") {
      					out += '<tr><td class="log">'+Log[i][0]+'</td><td class="log"><span class="log" id=\"'+Log[i][1]+'\">'+Log[i][1].toUpperCase()+ '</span></td><td width="100%" class="log">' +Log[i][2]+'</td></tr>';
      				}
      			}
      		}
      		out +="</table>";
      		logd.style.display = "block";
      		logd.innerHTML = out;
      	}
      }
      
      function selectLogLevel()
      {
      	var selObj = document.getElementById("selLogLevel");
      	if (selObj) {
      		var selIdx = selObj.selectedIndex;
      		selList = selObj.options[selIdx].value;
      		logLevel = selList;		
      		// addlog(selList, "info");
      		showLog();
      	}
      }
      
      function clearLog() 
      {
      	Log.length = 0;
      	showLog();
      }
      function resetCSCTable(c_table)
      {
      	DDUs.length = 0;
      	clearShowList("Folders", "All CSCs");
      	var ct = document.getElementById(c_table);
      	if (ct) {
      		var tds = ct.getElementsByTagName("td");	
      		for (var i=0; i< tds.length; i++) {
      			// var style=tds[i].style;
      			if (tds[i].getAttribute("class")) {
      				if (tds[i].getAttributeNode("class").value == "me_csc") {
      					id = tds[i].getAttributeNode("id").value;	
      					tds[i].style.background = '#AFAFAF';
      					tds[i].innerHTML = id.substr(id.lastIndexOf("\/")+1,id.length);
      					// tds[i].style = style;
      										
      				}
      				if (tds[i].getAttributeNode("class").value == "me_emu") {
      					id = tds[i].getAttributeNode("id").value;					
      					tds[i].innerHTML = "EMU Summary";					
      				}
      				if (tds[i].getAttributeNode("class").value == "me_ddu") {
      					id = tds[i].getAttributeNode("id").value;
      					tds[i].style.background = '#AFAFAF';
      					tds[i].innerHTML = id.substr(id.lastIndexOf("U")+1,id.length);
      					// tds[i].style = style;
      										
      				}
      			}			
      		}
      	}
      }
      
      function showCSCTable(id)
      {
      	var c_list = CSC_TYPES;
      	obj = document.getElementById(id);
      	if (obj) {
      		if (c_list && c_list.length > 0) {
      			// obj.innerHTML = "";
      			out = "";
      			out += "<table border=1 cellpadding=0 cellspacing=0 id='csc_table'>";
      			out += "<th class='RunLink' id='RunLink' colspan=38 align=left>Run:</th>";
      			
      			// Display Commons
      			out += "<tr class='me'><td id='cscCommon' class='me_emu' colspan='2' >EMU Summary</td><td colspan='36'></td></tr>";
      			
      			// Display DDUs 
      			out += "<tr class='me'><td id='cscDDU' class='me' colspan='2' >DDUs</td>";			
      			for (var i=1; i<= 36; i++) {
      				out += "<td id='cscDDU"+addPadding(i,2,'0')+"' class='me_ddu' >"+i+"</td>";
      			}
      			out += "</tr>";
      			
      			// Display CSCs
      			for (var i=0; i< c_list.length; i++) 
      			{
      				if (c_list[i] && c_list[i].length > 0) {
      					var side = c_list[i][0];
      			 		out += "<tr class='me'><td rowspan='9' id='"+side+"' class='me' >"+side+"</td>";
      					
      					var types =  c_list[i][1];
      					if (types && types.length > 0) {
      						for (var j=0; j< types.length; j++) {			
      							var csctype = types[j][0];
      							if (j>0) out+= "<tr class='me_type'>";
      							out += "<td id='"+csctype+"' class='me_type' >"+csctype+"</td>";		
      							var num_cscs = types[j][1];
      
      							for (var k=1; k<= num_cscs; k++) {
      								if (num_cscs==18) 
      									out += "<td class='me_csc' id='"+(csctype+"/"+addPadding(k,2,'0'))+"' colspan='2'>"+k+"</td>";
      								else 
      									out += "<td class='me_csc' id='"+(csctype+"/"+addPadding(k,2,'0'))+"'>"+k+"</td>";
      								
      							}
      							if (j>0) out += "</tr>";
      						}
      					}
      					out += "</tr>";		
      				}
      			}
      			out += "</table>";
      			out += printReportLegend();
      			obj.innerHTML = out;
      		}
      	}
      }
      
      function showDDUTable(id)
      {
      	// DDUs.length = 0;
      	// clearShowList("Folders", "All CSCs");
      	var c_list = DDUMAP;
      	
      	
      	obj = document.getElementById(id);
      	if (obj) {
      		if (c_list && c_list.length > 0) {
      			// obj.innerHTML = "";
      			out = "";
      			out += "<table border=1 cellpadding=0 cellspacing=0 id='ddumap_table'>";
      			// out += "<th class='RunLink' id='RunLink' colspan=38 align=left>Run Number: </th>";
      			// out += "<th class='RunLink' align=left colspan=38>Run Number: <a class='RLink' target=images href="+link+">"+RunNumber+"</a><br></th>";
      			// Display Commons
      			
      			
      			// Display DDUs 
      			//out += "<tr class='me'><td id='cscDDU' class='me' colspan='2' >DDUs</td>";	
      			out += "<tr><td class='me_type'>RUI#</td><td class='me_type'>DDU ID</td>";
      			for (var i=1; i<=15; i++) {
      				out += "<td class='me_type'>Input "+i+"</td>";
      			};
      			out += "</tr>";
      			for (var i=0; i<= c_list.length; i++) {
      				out += "<tr class='me'>";
      				rui = c_list[i];
      				if (rui && rui.length) {
      					out += "<td class='me_type' id='cscRUI"+i+"' class='me_ddu' >"+rui[1]+"</td>";
      					out += "<td class='me_type' id='csc"+rui[0]+"'>"+rui[0]+"</td>";
      					for (var j=4; j<19; j++) {
      						out += "<td id='csc"+rui[j]+"'>"+rui[j]+"</td>";
      					}
      				}
      				out += "</tr>";
      			}
      			
      			
      			
      			out += "</table>";
      			obj.innerHTML = out;
      		}
      	}
      }
      
      function findLinkedDDU(id)
      {
      	if (DDUMAP && DDUMAP.length) {
      		showDDUTable("ddutable_div");
      		for (var i=0; i<DDUMAP.length; i++) {
      			rui = DDUMAP[i];
      			for (var j=4; j<19; j++){
      				if (rui[j]==id) {
      					showConnectedCSCs(i+1, id);
      					return false;
      				}
      			}
      		}
      	}
      }
      
      function getLinkedDDU(id)
      {
              if (DDUMAP && DDUMAP.length) {
                      for (var i=0; i<DDUMAP.length; i++) {
                              rui = DDUMAP[i];
                              for (var j=4; j<19; j++){
                                      if (rui[j]==id) {
      				   ddu_link = rui[0] + " Input:" + (j-3);
      				   return ddu_link;
                                      }
                              }
                      }
              }
      	return "";
      }
      
      function showConnectedCSCs(id, csc)
      {
      	// updateCSCMappings();
      	// addlog("DDU"+id, "info");
      	if (DDUMAP && DDUMAP.length) {
      		rui=DDUMAP[id-1];
      		if (rui && rui.length) {
      			obj = document.getElementById("csc"+rui[0]);
                              if (obj) {
      				obj.style.background = "white";
      				obj.style.borderColor = "red";
                                      obj.style.borderWidth = "2px";
      			}
      			for (var i=4; i<19; i++) {
      				cscid="csc"+rui[i];
      				if (rui[i] != "") {
      					obj = document.getElementById(cscid);
      					if (obj) {
      						obj.style.background = "yellowgreen";
      						if (rui[i] == csc) {
      							obj.style.borderColor = "red";
              	                                        obj.style.borderWidth = "2px";
      						}
      					}
      				}
      			}
      			
      		}
      	}
      }
      
      
      function makeCSCid(crate, slot)
      {
      	var cscid="CSC_";
      	var crateID=crate.substr(5,crate.length);
      	var slotID=slot.substr(4,slot.length);
      	if (crateID.length==1) crateID='00'+crateID;
      	if (crateID.length==2) crateID='0'+crateID;
      	if (slotID.length==1) slotID='0'+slotID;
      	cscid += crateID+"_"+slotID;
      	return cscid;
      }
      
      function showHWTable() 
      {	
      	r_list = CSC_LIST;
      	csc_map = CSCMAP;
      	ddu_map = DDUMAP;
      	var link = "";
      	var out = "";	
      	
      	out += "<table class='hw_table'>";
      	
      	
      	isFolderValid=false;
      	if (r_list && r_list.length >0) {
      		crates = r_list[0];
      		
      		// RunNumber = r_list[0][0];		
      		out += "<th class='RunLink' align=left colspan=0><a class='RLink' target=images href="+link+">Run: "+RunNumber+"</a><br></th>";
      		for (var i=1; i<crates.length; i++) {
      			crate = crates[i][0];
      			if (crate=="crate255") continue;		
      			if (crate=="EMU") { 
      				Tag = crates[i][1];
      				ID = "hw_"+Tag;
      				out += "<tr><td class='hw_td'><a href=''  id=\'"+ID+"\' onClick='Folder=\""+Tag+"\"; selectSystemFolder(\""+Tag+"\");return loadPlot();'>EMU Summary</a></td>";
      				if (Folder.search("EMU") >=0) isFolderValid = true;						
      				//EMUs.push(Tag);
      				continue;
      			}
      			if (crate=="DDU") { 
      				
      				ddu_list = crates[i][1];
      				if (ddu_list.length > 0) {
      					out += "<tr><td class='hw_tr'>DDUs</td>";
      				for(var j=0; j< ddu_list.length; j++) {
      					if (ddu_list[j]) {
      					  	if ((j/9) && (j%9==0)) out += "</tr><tr><td></td>";	
      						Tag = ddu_list[j];						
      						idx = getDDUindex(Tag);
      						ID = "hw_"+Tag;						
      						if (Folder.search(Tag) >=0) isFolderValid = true;
      						var name=Tag;
      						for (var k=0; k<ddu_map.length; k++) {
      							map_entry = ddu_map[k];
      							if (!map_entry) continue;
      							if (map_entry[0] && map_entry[0] == ddu_list[j]) //{name += "<br>rui"+map_entry[1]+"/c"+map_entry[2]+"/s"+map_entry[3];}								
      								{name += "<br>("+idx+") c"+map_entry[2]+"/s"+map_entry[3];}
      						}
      						out += "<td class='hw_td'><a href='' id=\'"+ID+"\' onClick='Folder=\""+Tag+"\"; selectSystemFolder(\""+Tag+"\"); return loadPlot();'>"+name+"</a></td>";
      						// dduLink="<a href='#' id='" + dduID+ "' onClick='Folder=\""+entry+"\"; selectDDUFolder(\""+idx+"\"); return loadPlot();'>"+idx+"</a>";
      						// DDUs.push(Tag);
      					}
      				}						
      					out += "</tr>";
      					
      				}
      				continue;
      			}
      			
      			crate_str=getVMECrateName(crate) + ": "+crate;
      			out += "<tr><td class='hw_tr'><b>"+crate_str+"</b></td>";
      			// out += "<tr><td class='hw_tr'><b>"+crate+"</b></td>";
      			slots = crates[i][1];
      			for (var j=0; j<slots.length; j++) {
      				if (slots[j]) {
      					// Tag = crate+"/"+slots[j];
      					Tag=makeCSCid(crate, slots[j]);
      					ID = "hw_"+Tag;
      					if (!isFolderValid && (Folder == Tag)) isFolderValid=true;
      					//CSCs.push(Tag);
      					cscid = "";
      					for (var k=0; k<csc_map.length; k++) {
      						if (!csc_map[k]) continue;
      						map_entry = csc_map[k];
      						if ((map_entry[0] == crate) && (map_entry[1] == slots[j])) {cscid = "<br>"+map_entry[2];}
      					}
      					
      					
      					// csclink="<a href='#' id='" + ID+ "' onClick='Folder=\""+Tag+"\"; return loadFrame(\""+ID+"\",false, 1)'>"+slots[j]+cscid+"</a>";
      					csclink="<a href='' id='" + ID+ "' onClick='Folder=\""+Tag+"\"; selectSystemFolder(\""+Tag+"\"); return loadPlot();'>"+slots[j]+cscid+"</a>";
      					out += "<td class='hw_td'>"+csclink+"</td>";
      				}
      			}
      			out += "</tr>";
      		}
      	
      	}
      	out += "</table>";
      	
      	var o_obj = document.getElementById("hwtable_div");
      	if (o_obj) o_obj.innerHTML = out;
      	// if (parent.isFolderValid) 
      	// select(Folder, false, 1 );
      
      }
      
      // Load Available offline Runs list
      
      function showNodeDetailedStatus(id) {
      	var out="";
      	var nodes=NODES_LIST;
      	obj = document.getElementById("nodestatus_div");
      	if (nodes && nodes.length>1) {
      		var idx=false;
      		for (i=1; i<nodes.length; i++) {
      			if (nodes[i] && nodes[i].length) {
      				node = nodes[i][0].substr(nodes[i][0].lastIndexOf('-')+1,nodes[i][0].length);
      				if (node == id) idx=i;
      			}
      		}
      		if (obj && nodes[idx] && nodes[idx].length && idx) {
      			out +="<table class='nodes_table'>";
      			// Show Table Header
      			if (nodes.length && nodes[0] && nodes[0].length) {
      				for (i=0; i< nodes[0].length; i++) {
      					out+="<th>"+nodes[0][i]+"</th>";
      				}
      			}
      			// Show Node Status 
      			out+="<tr>";
      			out+="<td class='node_info'><a target='shownode' href='"+nodes[idx][1]+"'>"+nodes[idx][0]+"</a></td>";
      			state = nodes[idx][2];
      			id = 'node_'+node;
      			var color='white';
      			if (state.search("Enabled") >=0) {color='#90ff90';}
      			else if (state.search("Halted") >=0) {color='#ff9090';}
      			else if (state.search("Ready") >=0) {color='#ffff90';}
      			else if (state.search("Unknown") >=0) {color='909090';}
      			
      			out +="<td class='node_info' style='background-color: "+color+"'>"+state+"</td>";
      			for (j=3; j<nodes[idx].length; j++) {
      				var value = nodes[idx][j];
      			        // Fix run start time. should be UTC
      			        if (j==4) value = value.replace("CEST", "UTC");
				if (j==6) value = "<a href='' onClick='getNodeHistory(\""+nodes[idx][0]+"\",\"averageRate\"); return false;' title='Show DQM Rate history'><b>"+value+"</b></a>";
				if (j==9) value = "<a href='' onClick='getNodeHistory(\""+nodes[idx][0]+"\",\"cscRate\"); return false;' title='Show CSC Rate history'><b>"+value+"</b></a>";
      				out+="<td class='node_info'>"+value+"</td>";
      			}
      			out+="</tr>";
      			out +="</table>"	
      			obj.innerHTML=out;
      		} else {
      			if (selNode != "") addlog("Selected Monitor node "+selNode+" is down", "warn");
      			selNode="";
      			obj.innerHTML="";
      		}
      	}
      	return false;
      }

      function getNodeHistory(node, param)
      {
        var fullUrl = baseURL + getNodesHistory + "?";
	var fShowTotal = false;
	if (!param || param=="") param="ALL";
        fullUrl += "param="+param;
	if (node=="") fShowTotal = true;
	if (!node || node=="") node="ALL"; 
	fullUrl += "&node="+node;
	addlog(fullUrl, "debug");
	
        var req=false;
        if (window.XMLHttpRequest) { 
                /*
                try {
                        netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite");
                } catch (e) {
                        alert("Permission UniversalBrowserRead denied.");
                }
                */
            req = new XMLHttpRequest();    
           
        } else if (window.ActiveXObject) {    
                //req = new ActiveXObject("Microsoft.XMLDOM");
            req = new ActiveXObject((navigator.userAgent.toLowerCase().indexOf('msie 5') != -1) ? "Microsoft.XMLHTTP" : "Msxml2.XMLHTTP");
                // var req = new ActiveXObject("Microsoft.XMLHTTP");
        }
          req.open("GET",fullUrl,true); // true= asynch, false=wait until loaded    
        
          req.onreadystatechange = function() {
              if (req.readyState == 4) {
                        if (req.status==200) {          
				NODES_HISTORY = false;
                                var reply = req.responseText;
                                // Need to strip malformed array string to satisfy IE7
                                reply = reply.replace(/,]/g,"]");
				reply = reply.replace(/,}/g,"}");
                                reply = reply.replace("var ","");
                                window.eval(reply);
				// obj = document.getElementById("plots_div");
				// if (obj) obj.innerHTML = "<pre>" + reply + "</pre>";
				showNodeHistory(node, param, fShowTotal);
                                req=false;
                                
                } else if (req.status==404) {
			NODES_HISTORY = false;
			addlog("Can not load " + fullUrl, 'warn');
                }
                                                
                }
          }
        req.send(null); 
        return false;
      }

      function showNodeHistory(node, param, show_total) {
 
        var stats=NODES_HISTORY;
        if (stats)
        {
	  var history = stats.history;
	  if (history && (history.length > 0))
	  {
		var options = {
          chart: {
                renderTo: 'plots_div',
		zoomType: 'x'
          },

	  title: {
		text: 'Monitoring Nodes Status History'
	  },

	  subtitle: {
		text: ''
	  },

	  xAxis: {
		type: 'datetime',
		title: {
			text: 'Date/Time'
		}
          },

	  yAxis: {
	    title: {
		text: ''
	    },
	    min: 0
	  },

          series: []

          };

	  options.subtitle.text = node + ' node(s) - (parameter: '+param+')';
          options.yAxis.title.text = param + ' (evt/s)';

          if (history.length && history[0].stats.length) {
	     if (show_total) {
		var serie = [];
                serie.name = 'Total ' + param;
                serie.data = [];
                options.series.push(serie);
             } else {
	       for (j=0; j<history[0].stats.length; j++) {
	         var serie = [];
	         serie.name = history[0].stats[j].node;
	         serie.data = [];
                 options.series.push(serie); 
	       }
	     }

	     for (i=0; i<history.length; i++ )
		{
                   if (history[i].stats.length)
		    {
		      var tstamp = new Date(eval(eval(history[i].tstamp)*1000));
		      var val_total = 0;
		      for (j=0; j<history[i].stats.length; j++)
			{
			var val = eval(eval("history[i].stats[j]."+param));
			val_total = eval(val_total+val);
			if (!show_total) {
			var sample = [];
			sample.push(Date.UTC(tstamp.getYear(), tstamp.getMonth(), tstamp.getDate(), tstamp.getHours(), tstamp.getMinutes(), tstamp.getSeconds()) );
			sample.push(val);
			options.series[j].data.push(sample);
			}
		// 	addlog(history[i].tstamp + ": " + tstamp + " " + history[i].stats[0].cscRate, "debug");
			}
		      if (show_total) 
		       {
			var sample = [];
                        sample.push(Date.UTC(tstamp.getYear(), tstamp.getMonth(), tstamp.getDate(), tstamp.getHours(), tstamp.getMinutes(), tstamp.getSeconds()) );
                        sample.push(val_total);
			options.series[0].data.push(sample);
		       }
		     }
		}
             var chart = new Highcharts.Chart(options);
	   }
	 }
        } 

	return false;
      }


      
      function showNodeInfo(id)
      {
      	obj = document.getElementById("nodestatus_div");
      	if (obj) {
      		if (id == selNode) {
      			if (obj.style.display == 'none') obj.style.display = '';
      			else obj.style.display = 'none';
      		} else {
      			obj.style.display = '';
      		}	
      		/*obj.style.position = "absolute";
      		obj.style.left=300;// window.event.clientX;
      		obj.style.top=100; // window.event.clientY+10;
      		*/
      	}
         return false;
      	
      }
      
      function addToNodesHistory(nodes)
      {
      		var time = new Date();
      		var tstamp= time.getHours()+":"+time.getMinutes()+":"+time.getSeconds();
      		// entry=nodes;
      		// entry.push(tstamp);
      		idx = NodesHistory.push(nodes);
      		// NodesHistory[idx-1].push(tstamp);
      		if (NodesHistory.length>histDepth) NodesHistory.shift();
      }
      
      function showRateHistory(id) {
      	var title="Rate history for Node:" + id;
      	// addlog(NodesHistory.length, "debug");
      	// return false;
      	/*
      	for (i=0; i<NodesHistory.length; i++)  {
      			// addlog(NodesHistory.length, "debug");
      		
      			entry= NodesHistory[i];
      			if (entry && entry.length) {
      				for (j=0; j<entry.length; j++) {
      					node_entry = entry[j];
      					if (node_entry && node_entry.length) {
      						node = node_entry[0].substr(node_entry[0].lastIndexOf('-')+1,node_entry[0].length);
      						if (node== id) {
      							rate = node_entry[6];							
      							addlog(node+":"+rate, "debug");
      						}
      					}
      				}
      			}
      		}
      	return false;
      	*/
      	try {
      		var generator=window.open('/rates','name','height='+100+',width='+200+',resizable=yes');						
      		if (window.focus) {generator.focus()} 
      		generator.document.write('<html><head><title>'+title+'</title>');
      		generator.document.write("<style>body {color: #000000; background-color: #9090FF;margin: 2px;font-family:Arial;	overflow: auto;}"+
      		"span.winTitle {	margin: 0;font-size: 12px;font-weight: bold;text-decoration: none;color: #000000;}"+
      		"fieldset {background-color: #ddd;	border-style: solid;border-width: 1px;border-color: black;margin: 2px;padding: 2px;}"+
      		"legend {border-style: solid;border-width: 1px;background-color:  #C0C0FF;}</style>");
      		generator.document.write('</head><body>');
      		generator.document.write("<fieldset><legend><span class='winTitle'>"+title+"</span></legend>");
      		
      		
      		for (var i=0; i<NodesHistory.length; i++)  {
      		
      			// generator.document.write(NodesHistory.length+"<br>");
      			
      			entry= NodesHistory[i];
      			if (entry && entry.length) {
      				for (j=0; j<entry.length; j++) {
      					node_entry = entry[j];
      					if (node_entry && node_entry.length) {

      						node = node_entry[0].substr(node_entry[0].lastIndexOf('-')+1,node_entry[0].length);
      						if (node== id) {
      							rate = node_entry[6];	
      							// time = entry[entry.length-1];
      							generator.document.write(rate+"<br>");
      							// addlog(node+":"+rate, "debug");
      						}
      					}
      				}
      			}
      			
      		}
      		
      		generator.document.write("</fieldset>");
      		// generator.document.write('<p><a href="javascript:self.close()">Close</a> the popup.</p>');
      		generator.document.write('</body></html>');
      		generator.document.close();
      	  } 
      	  catch (exc){
      	}
      	return false;
      }
      
      function sendDQMAction(action) 
      {
        var fullUrl = baseURL + controlDQM;
      	params = "?action="+action;
      	fullUrl+=params;
      	var req=false;
      	if (window.XMLHttpRequest) { 
      		/*
      		try {
      	    		netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite");
      	   	} catch (e) {
      	    		alert("Permission UniversalBrowserRead denied.");
      	   	}
      		*/
      	    req = new XMLHttpRequest();    
      	   
      	} else if (window.ActiveXObject) {    
      		//req = new ActiveXObject("Microsoft.XMLDOM");
      	    req = new ActiveXObject((navigator.userAgent.toLowerCase().indexOf('msie 5') != -1) ? "Microsoft.XMLHTTP" : "Msxml2.XMLHTTP");
      		// var req = new ActiveXObject("Microsoft.XMLHTTP");
      	}
          req.open("GET",fullUrl,true); // true= asynch, false=wait until loaded    
      	
          req.onreadystatechange = function() {
              if (req.readyState == 4) {
      			if (req.status==200) {	        
      				var reply = req.responseText;
      				addlog("Sent DQM command "+action, "info");
      				// setDQMStatus(action);
      				req=false;				
      	    	} else if (req.status==404) {
      				addlog("Unable to send DQM command "+action, "error");
      				//setDQMStatus("Unable " + action);
      	    	}
      						
      		}
          }
      	req.send(null);	
      	// addlog("Update Nodes List", "info");
      	return false;
      }
      
      function sendDisplayAction(action) 
      {
        var fullUrl = baseURL + controlDisplay;
              params = "?action="+action;
              fullUrl+=params;
              var req=false;
              if (window.XMLHttpRequest) { 
                      /*
                      try {
                              netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite");
                      } catch (e) {
                              alert("Permission UniversalBrowserRead denied.");
                      }
                      */
                  req = new XMLHttpRequest();    
                 
              } else if (window.ActiveXObject) {    
                      //req = new ActiveXObject("Microsoft.XMLDOM");
                  req = new ActiveXObject((navigator.userAgent.toLowerCase().indexOf('msie 5') != -1) ? "Microsoft.XMLHTTP" : "Msxml2.XMLHTTP");
                      // var req = new ActiveXObject("Microsoft.XMLHTTP");
              }
          req.open("GET",fullUrl,true); // true= asynch, false=wait until loaded    
              
          req.onreadystatechange = function() {
              if (req.readyState == 4) {
                              if (req.status==200) {          
                                      var reply = req.responseText;
                                      addlog("Sent Display command "+action, "info");
                                      req=false;                              
                      } else if (req.status==404) {
                                      addlog("Unable to send Display command "+action, "error");
                      }
                                                      
                      }
          }
              req.send(null); 
              return false;
      }
      
      
      function setDQMStatus(msg)
      {
      	obj = document.getElementById("dqm_control_status");
      	if (obj) {
      		obj.innerHTML = msg;
      	}
      }
      
      function updateNodesStatus()
      {
      	
      	var out="";
      	var nodes=NODES_LIST;
      	obj = document.getElementById("nodesview_div");
      	if (obj) {
      
      			
      		var out = printNodeStatusLegend();
      		out += "<table>";	
      		nodeclass="EmuMonitor"
      		out +="<tr><td><a href='' onClick='return showAllNodesStatuses();' title='Click to view All EmuMonitors nodes statuses'><b>" + nodeclass + "s:</b</a></td>";
      		for (var i=1; i<=36; i++) {
      			color="#C0C0C0";
      			node=i;
      			out +="<td class='node' style='background-color: "+color+"' id='node_"+i+"'>"+node+"</td>";
      		}
      		out +="</tr>";
      		out +="<tr>";
      		out +="<tr><td><a href='' onClick='getNodeHistory(\"ALL\",\"averageRate\"); return false;' title='Click to view All Nodes DQM Rate history'><b>Rate Evts/sec</b></a></td>";
      		for (var i=1; i<=36; i++) {
      			rate="-";
      			out +="<td class='node' id='rate_node_"+i+"'>"+rate+"</td>";
      		}
      		out +="</tr>";
      		out +="<tr>";
      		out +="<tr><td><a href='' onClick='getNodeHistory(\"ALL\",\"cscRate\"); return false;' title='Click to view All Nodes CSC Rate history'><b>Rate CSCs/sec:</b></a></td>";
      		for (var i=1; i<=36; i++) {
      			rate="-";
      			out +="<td class='node' id='csc_rate_node_"+i+"'>"+rate+"</td>";
      			
      		}
      		out +="</tr>";
      		out +="</table>";
      		obj.innerHTML=out;
      	
      		var isDead = false;	
      		if (nodes) {
      			addToNodesHistory(nodes);
      			if (nodes.length>1) {		
      				totalDAQevents=0;
      				totalDQMevents=0;
      				totalCSCblocks=0;
      				totalDQMrate=0;
      				totalCSCrate=0;
      				for (i=1; i<nodes.length; i++) {
      					if (!nodes[i]) continue;
      					node = nodes[i][0].substr(nodes[i][0].lastIndexOf('-')+1,nodes[i][0].length);
      					state = nodes[i][2];
      					rate = nodes[i][6];
      					csc_rate = nodes[i][9];
      					RunNumber=nodes[i][3];
      					RunStartTime=nodes[i][4];
      					RunStartTime = RunStartTime.replace("CEST","UTC"); 
      					
      					// id = 'node_'+node;
      					id=node;
      					node = "<a href='' onClick='showNodeDetailedStatus(\""+node+"\");showNodeInfo(\""+node+"\");selectNode(\""+node+"\");return false;'>"+node+"</a>";
      					var color='white';
      					if (state.search("Enabled") >=0) {color='#90ff90';}
      					else if (state.search("Halted") >=0) {color='#ff9090';}
      					else if (state.search("Ready") >=0) {color='#ffff90';}
      					else if (state.search("NA") >=0) {color='white';}
      					cell = document.getElementById('node_'+id); 
      					if (cell){
      						cell.innerHTML=node;
      						cell.style.background = color;
      					}
      					cell = document.getElementById('rate_node_'+id); 
      					if (cell){
      						cell.innerHTML="<a href='' onClick='getNodeHistory(\""+nodes[i][0]+"\",\"averageRate\"); return false;' title='Click to view DQM Rate history'>"+rate+"</a>";
      					}
      					cell = document.getElementById('csc_rate_node_'+id); 
      					if (cell){
      						cell.innerHTML="<a href='' onClick='getNodeHistory(\""+nodes[i][0]+"\",\"cscRate\"); return false;' title='Click to view CSC Rate history'>"+csc_rate+"</a>";
      					
      					}
      					
      					if (NODES_SAVED && NODES_SAVED[i] && NODES_SAVED[i][2])
      					{
      						if ( (state.search("NA") >=0) && (NODES_SAVED[i][2].search("NA") < 0) )	
      						{
      							isDead = true;
      						}
      					}
      
      					totalDAQevents += parseInt(nodes[i][4]);
      					totalDQMevents += parseInt(nodes[i][5]);
      					totalDQMrate += parseInt(nodes[i][6]);
      					totalCSCblocks += parseInt(nodes[i][8]);
      					totalCSCrate += parseInt(nodes[i][9]);
      					
      				}
      				
      			}
      		}
      	
      		if (isDead) alert("Some of the DQM EmuMonitors modules just died!\nReload and Restart Local DQM!");	
      		NODES_SAVED = NODES_LIST;
      	}	
      
      }
      
      function getNodesList()
      {
      	var fullUrl = baseURL + NodesStatus;
      	getNodesListDelay=10;
      	var req=false;
      	if (window.XMLHttpRequest) { 
      		/*
      		try {
      	    		netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite");
      	   	} catch (e) {
      	    		alert("Permission UniversalBrowserRead denied.");
      	   	}
      		*/
      	    req = new XMLHttpRequest();    
      	   
      	} else if (window.ActiveXObject) {    
      		//req = new ActiveXObject("Microsoft.XMLDOM");
      	    req = new ActiveXObject((navigator.userAgent.toLowerCase().indexOf('msie 5') != -1) ? "Microsoft.XMLHTTP" : "Msxml2.XMLHTTP");
      		// var req = new ActiveXObject("Microsoft.XMLHTTP");
      	}
          req.open("GET",fullUrl,true); // true= asynch, false=wait until loaded    
      	
          req.onreadystatechange = function() {
              if (req.readyState == 4) {
      			if (req.status==200) {	        
      				var reply = req.responseText;
      				// Need to strip malformed array string to satisfy IE7
      				reply = reply.replace(/,]/g,"]");
      				reply = reply.replace("var ","");
      	        	        window.eval(reply);
      				updateNodesStatus();
      				selectNode(selNode);
      				showNodeDetailedStatus(selNode);
      				if (all_nodes_status_window && !all_nodes_status_window.closed)
      				  { showAllNodesStatuses(); }
      				req=false;
      				
      	    	} else if (req.status==404) {
      	    	}
      						
      		}
          }
      	req.send(null);	
      	setTimeout('getNodesList()', 10000);
      	// addlog("Update Nodes List", "info");
      	return false;
      }
      
      function getTestsList()
      {
      	var fullUrl = baseURL + TestsList+"?run="+RunName;
      	
      	
      	var req=false;
      	if (window.XMLHttpRequest) { 
      		/*
      		try {
      	    		netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite");
      	   	} catch (e) {
      	    		alert("Permission UniversalBrowserRead denied.");
      	   	}
      		*/
      	    req = new XMLHttpRequest();    
      	   
      	} else if (window.ActiveXObject) {    
      		//req = new ActiveXObject("Microsoft.XMLDOM");
      	    req = new ActiveXObject((navigator.userAgent.toLowerCase().indexOf('msie 5') != -1) ? "Microsoft.XMLHTTP" : "Msxml2.XMLHTTP");
      		// var req = new ActiveXObject("Microsoft.XMLHTTP");
      	}
          req.open("GET",fullUrl,true); // true= asynch, false=wait until loaded    
      	
          req.onreadystatechange = function() {
              if (req.readyState == 4) {
      			if (req.status==200) {	        
      				var reply = req.responseText;
      				// Need to strip malformed array string to satisfy IE7
      				reply = reply.replace(/,]/g,"]");
      				reply = reply.replace("var ","");
      	        	window.eval(reply);
      				loadTestsList (TREE_ITEMS, "tests_div");
      				// addlog(reply, 'debug');
      				updateBrowserPage(Canvas,false,3);				
      				// updateBrowserPage(id,false,2);
      	    	} else if (req.status==404) {
      				addlog("Can not load " + fullUrl, 'error');
      	    	}
      						
      		}
          }
      	req.send(null);	
      	return false;
      }
      
      // Load Avai;able Tests/Canvases ist
      function loadTestsList(r_list, id) 
      {
      	obj = document.getElementById(id);
      	if (obj) {
      		if (r_list) {
      			out = "";
      			for (var i = 0; i< r_list.length; i++) {
      				// document.write("<tr><td><b>"+r_list[i][0]+"</b></td></tr>");
      				if (!r_list[i]) continue;
      				out += "<fieldset>";
      				
      				th_folder = r_list[i][0];
      				th_id = "folder_"+ th_folder;
      				out += "<legend class='t_hdr'><a class='test_hdr' href='' onClick='return showHide(\""+th_id+"\");'>"+th_folder+"</a></legend>";
      				if (r_list[i][0] == "EMU") 
      					{ scope = "EMU";}
      				else if (r_list[i][0] == "DDU") 
      					{ scope = "DDU";}
      				else 
      					{scope = "CSC";}
      				var child = [];				
      				child=r_list[i];
      				out += "<div class='t_div' id='"+th_id+"' style='overflow: hidden;'>";
      				t_map = [];
      				for (var j=2; j<child.length; j++) {
      					if (!child[j]) continue;
      					t_id = child[j][1];
      					t_name = child[j][0];
      					// === Replace with search()
      					if (t_name.lastIndexOf(":") != -1) {
      						t_folder = t_name.substr(0, t_name.lastIndexOf(":"));			
      						t_name = t_name.substr(t_name.lastIndexOf(':')+1, t_name.length);
      					} else {
      						t_folder = th_folder;
      					}
      					if (!t_map[t_folder])
      						t_map[t_folder] = new Array();
      					if (!t_map[t_folder][t_id])
      						t_map[t_folder][t_id] = t_name;
      				}
      				for (var list in t_map) {
      					if ((list != th_folder) || (list == "CSC")) {
      						out += "<fieldset>";
      						out += "<legend class='t_hdr'><a class='test_hdr2' href='' onClick='return showHide(\"id_"+list+"\"); return false;'>"+list+"</a></legend>";
      						out += "<div class='t_div' id='id_"+list+"' style='overflow: hidden;'>";				
      					}
      					out += "<table class='tests_table'>";
      					folder = t_map[list];			
      					for (var entry in folder) {
      						// <td><input type=checkbox id='cb_"+entry+"'></td>
      						out += "<tr><td id =\""+entry+"\"><a class='add_to_list' href='' onClick='addToTestsShowList(\"Custom\",\""+entry+"\",\""+folder[entry]+"\" ,\""+scope+"\");return false;'>[+]</a>";
      						// out += "<tr></td><td><a class='add_to_list' href='' onClick='addToTestsShowList(\"Custom\",\""+entry+"\",\""+folder[entry]+"\" ,\""+scope+"\");return false;'>[+]</a>";
      						out += "</a><a class='test_item' href='' id =\""+entry+"\"  onClick='Canvas=\""+entry+"\";Scope=\""+scope+"\";return updateBrowserPage(\""+entry+"\",false,3)'>"+folder[entry]+"</a></td></tr>";			 				
      						if (scope=="CSC" ) { 
      							addToTestsShowList("All CSC Tests", entry, folder[entry], scope);
      						}
      							
      							
      					}
      					out += "</table>";
      				
      					if ((list != th_folder)|| (list == "CSC")) out += "</div></fieldset>";
      					
      				}
      				
      				out += "</div></fieldset>";
      
      			}
      			obj.innerHTML = out;
      		}		
      	}	
      }	
      
      
      // Load Available CSCs list for selected Run 
      function loadCSCList()
      {
      	getCSCListDelay=20;
      	var fullUrl = baseURL+CSCList+"?run="+RunName;
      	// var r_link=document.getElementById("RunLink");
      	// if (r_link) r_link.innerHTML = "Run Number: <a class='RLink' href=''>" + RunNumber + "</a>";
      	// addlog("called loadCSCList for "+RunName, "debug");	
      	var req=false;
      	if (window.XMLHttpRequest) { 
      		/*
      		try {
      	    		netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite");
      	   	} catch (e) {
      	    		alert("Permission UniversalBrowserRead denied.");
      	   	}
      		*/
      	    req = new XMLHttpRequest();    
      	   
      	} else if (window.ActiveXObject) {    
      		//req = new ActiveXObject("Microsoft.XMLDOM");
      	    req = new ActiveXObject((navigator.userAgent.toLowerCase().indexOf('msie 5') != -1) ? "Microsoft.XMLHTTP" : "Msxml2.XMLHTTP");
      		// var req = new ActiveXObject("Microsoft.XMLHTTP");
      	}
          req.open("GET",fullUrl,true); // true= asynch, false=wait until loaded    
      	
          req.onreadystatechange = function() {
              if (req.readyState == 4) {
      			if (req.status==200) {	        
      				var reply = req.responseText;
      				// Need to strip malformed array string to satisfy IE7
      				reply = reply.replace(/,]/g,"]");
      				reply = reply.replace("var ","");
      	        	window.eval(reply);
      				showHWTable();				
      				updateCSCMappings();
      				selectSystemFolder(selFolder);
      				getDQMReport();
      				
      				selectObject(RunName,false,2);
      				// selectObject(id, false, 2);				
      				// addlog(document.URL, "info");
      				req=false;
      	    	} else if (req.status==404) {
      	    	}
      						
      		}
          }
        	req.send(null);
              if (RunName == "Online")
              {
                setTimeout('loadCSCList()', 20000);
              }
      	return false;
      }
      
      function getCSCCounters()
      {
      	// getCSCListDelay=20;
      	var fullUrl = baseURL+CSCCounters+"?run="+RunName;
      	// var r_link=document.getElementById("RunLink");
      	// if (r_link) r_link.innerHTML = "Run Number: <a class='RLink' href=''>" + RunNumber + "</a>";
      	
      	var req=false;
      	if (window.XMLHttpRequest) { 
      		/*
      		try {
      	    		netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite");
      	   	} catch (e) {
      	    		alert("Permission UniversalBrowserRead denied.");
      	   	}
      		*/
      	    req = new XMLHttpRequest();    
      	   
      	} else if (window.ActiveXObject) {    
      		//req = new ActiveXObject("Microsoft.XMLDOM");
      	    req = new ActiveXObject((navigator.userAgent.toLowerCase().indexOf('msie 5') != -1) ? "Microsoft.XMLHTTP" : "Msxml2.XMLHTTP");
      		// var req = new ActiveXObject("Microsoft.XMLHTTP");
      	}
          req.open("GET",fullUrl,true); // true= asynch, false=wait until loaded    
      	
          req.onreadystatechange = function() {
              if (req.readyState == 4) {
      			if (req.status==200) {	        
      				var reply = req.responseText;
      				// Need to strip malformed array string to satisfy IE7
      				reply = reply.replace(/,]/g,"]");
      				reply = reply.replace("var ","");
      	        	window.eval(reply);
      				showCSCCounters();
      				req=false;
      	    	} else if (req.status==404) {
      	    	}
      						
      		}
          }
      	req.send(null);	
      	if (RunName == "Online")
              {
      	  setTimeout('getCSCCounters()', 20000);
      	}
      	return false;
      }
      
      
      function findTestPlotInfo(id)
      {
      	var testPlot = "";
      	// addlog(id, "debug");
      	if (TESTS_MAP && TESTS_MAP.bindings.length) {
      		for (var i = 0; i < TESTS_MAP.bindings.length; i++) {
      			map_entry = TESTS_MAP.bindings[i];
      			if (map_entry && map_entry.testID && map_entry.testPlot
      				&& (map_entry.testID == id)) { 
      					// addlog("Found " + id, "debug");
      					return map_entry;
      				}
      		}
      	}
      		
      	return false; 	
      }
      
      
      function crateID(tag)
      {
      	var pos = tag.search("crate");
      	if ( pos >=0) return parseInt(tag.substr(pos+5,tag.length));
      	return 0;
      }
      
      function slotID(tag)
      {
      	var pos = tag.search("slot");
      	if ( pos>=0 ) return parseInt(tag.substr(pos+4,tag.length));
      	return 0;
      }
      
      function findHWId(id)
      {
      	var m_list = CSCMAP;
      	if (m_list.length>0) {
      		for (var i=0; i<m_list.length; i++) {
      			if (m_list[i][2] == id )
      			   return "CSC_"+addPadding(crateID(m_list[i][0]),3,'0')+"_"+addPadding(slotID(m_list[i][1]),2,'0');		
      		}	
      	}
      	return "";
      }
      
      
      
      function getPCrateId(id)
      {
      	var m_list = CSCMAP;
              if (m_list.length>0) {
                      for (var i=0; i<m_list.length; i++) {
                              if (m_list[i][2] == id )
                                 return getVMECrateName(m_list[i][0]) +  " (PCrate:" +crateID(m_list[i][0])+"; DMB Slot:"+slotID(m_list[i][1]) + ")";            
                      }       
              }
              return "";
      }
      
      function getFolderName(id, scope) {
      	if (scope == "EMU") return "EMU";
      	if (scope == "DDU" && (id.search("DDU_") >=0)) return id;
      	if (scope == "CSC" ) return findHWId(id);
      	return id;
      }
      
      
      function findReportEntry(report, id)
      {
      	
      	for (var i = 0; i < report.length; i++) {
      		if (report[i].objID  == id)
      			return report[i];
      	}
      	return false;
      }
      
      function setTestsStatus(id)
      {
      	loadTestsList (TREE_ITEMS, "tests_div");
      	var out = "<table class='page_layout_status' style='border: 0px black solid;'>";
      	if ( id.search("ME") >=0 )
      	{
      	  out += "<tr style='border: 1px black solid;'><td style='border: 0px black solid;'><b>" + id + "</b> ";
      	  out += "is connected to <b><font color='blue'>" + getPCrateId(id) + "</font></b>; fiber linked to <b><font color='blue'>"  + getLinkedDDU(id) + "</font></b></td>";
      	  out += "</tr><tr style='border: 1px black solid;' ><td style='border: 1px black solid;'> Counters: " + getCountersForCSC(id) + "</td>";
      	} else {
      	  out += "<tr style='border: 1px black solid;'><td style='border: 0px black solid;'><b>" + id + "</b></td>";
      	}
      	
      	out += "</tr>";
      	out += "</table>";
      
      	out += "<table class='page_layout' style='border: 0px black solid;'><tr style='border: 0px black solid;'><td style='border: 0px black solid;'><table class='dqm_report'><tr><th class='repScope' colspan=2><b>Run " + RunName + " Status for " + id + "</b></th>";	
              if (KNOWN_PROBLEMS)
                      out += "<th class='repScope' colspan=2><b>Problem Known as</b></th>";
      	if (REF_DQM_REPORT) 
                      out += "<th class='repScope' colspan=2><b>Compared to Run " + selRefRun + "</b></th>";
      	out += "</tr>";
      	if (DQM_REPORT && DQM_REPORT.report.length) {
      		var repentry = findReportEntry(DQM_REPORT.report, id);
      		if (repentry) {	
      			
      			if (repentry.list && repentry.list.length) {
      				err_list = repentry.list;
      				
      				for (var j=0; j< err_list.length; j++) {
      					var entry = err_list[j];
      					var known_entry = "";
      					if (entry) {
      						
      						//out += "<tr><td></td><td>" + entry.descr + "</td><td>"+entry.severity+"</td></tr>";
      						
      						var sev_idx = parseInt(entry.severity);
      						
      						var sev_name = DQM_SEVERITY[sev_idx].name;
      						var sev_str = "";
      						if ( sev_idx > 0) {
      							sev_str = "<span>" + sev_name + "</span>";
      						} 
      												
      						var descr_str = entry.descr;
      						if (entry.testID != "") {
      							var testInfo = findTestPlotInfo(entry.testID);
      							if (testInfo) {
      								var testFolder = getFolderName(repentry.objID, testInfo.testScope);//getFolder()
      								var testPlot = testInfo.testPlot + ".png";
      								var t_obj = document.getElementById(testPlot);
      								if (t_obj) {
      									if ( ((id.search("ME") >=0) || ((id.search("DDU") >=0) && fCompareDDUs))
      										&& isProblemRepeating(id, entry)) sev_idx = 5; // REPEATING problem
      									if (fShowKnownProblems) {
      									if ( ((id.search("ME") >=0) || ((id.search("DDU") >=0) && fCompareDDUs))
      										&& isProblemKnown(id, entry)) {
      										// sev_idx = 6; // KNOWN problem
      										t_obj.style.border = "2px solid magenta";
      										known_entry = getKnownProblemEntry(id, entry);
      										}
      									}
      									t_obj.style.background = DQM_SEVERITY[sev_idx].color;
      								}
      								// descr_str = entry.descr + " " +testPlot;
      								descr_str = "<a href='' onClick='Folder=\""+testFolder+"\";Scope=\""+testInfo.testScope+"\";Canvas=\""+testPlot+"\";return updateBrowserPage(\""+testPlot+"\",false,3)'>"+add_show_icon() + entry.descr + "</a> ";
      							}
      							
      						}
      						out += "<tr><td class='SEVERITY_"+sev_name+"'>" + sev_str+ "</td><td>"+ descr_str + "</td>"
      						if (known_entry != "" ) {
      							var sev_idx = parseInt(known_entry.severity);
                                                      
                                                      	var sev_str = DQM_SEVERITY[sev_idx].name;
                                                      	if ( sev_idx > 0) {
      
                                                      	var descr_str = known_entry.descr;
      
                                                      	out += "<td class='SEVERITY_"+sev_name+"'>" + sev_str+ "</td><td>"+ descr_str + "</td>";
      							}
      						}
      					        out +="</tr>";
      					}
      				}
      			}							
      		}
      	}
      	out += "</table></td><td style='border: 0px black solid;'>";
      	
      	
      /*	
      	if (KNOWN_PROBLEMS) {
      		out += "<table class='dqm_report'><tr><th class='repScope' colspan=2><b>Problem Known as</b></th></tr>";
      		var repentry = findReportEntry(KNOWN_PROBLEMS.report, id);
      		if (repentry) {	
      			
      			if (repentry.list && repentry.list.length) {
      				var err_list = repentry.list;
      				
      				for (var j=0; j< err_list.length; j++) {
      					var entry = err_list[j];
      					if (entry) {
      						
      						//out += "<tr><td></td><td>" + entry.descr + "</td><td>"+entry.severity+"</td></tr>";
      						
      						var sev_idx = parseInt(entry.severity);
      						
      						var sev_name = DQM_SEVERITY[sev_idx].name;
      						var sev_str = "";
      						if ( sev_idx > 0) {
      							sev_str = "<span class='SEVERITY_"+sev_name+"'>" + sev_name + "</span>";
      						} 
      												
      						var descr_str = entry.descr;
      						
      						out += "<tr><td>" + sev_str+ "</td><td>"+ descr_str + "</td></tr>";
      					}
      				}
      			}							
      		}
      		out += "</table>";
      	}
      	
      	out += "</td><td style='border: 0px black solid;'>";
      	
      	
      	if (REF_DQM_REPORT) {
      		out += "<table class='dqm_report'><tr><th class='repScope' colspan=2><b>Compared to Run " + selRefRun + "</b></th></tr>";
      		var repentry = findReportEntry(REF_DQM_REPORT.report, id);
      		if (repentry) {	
      			
      			if (repentry.list && repentry.list.length) {
      				var err_list = repentry.list;
      				
      				for (var j=0; j< err_list.length; j++) {
      					var entry = err_list[j];
      					if (entry) {
      						
      						//out += "<tr><td></td><td>" + entry.descr + "</td><td>"+entry.severity+"</td></tr>";
      					et
      						var sev_idx = parseInt(entry.severity);
      						
      						var sev_name = DQM_SEVERITY[sev_idx].name;
      						var sev_str = "";
      						if ( sev_idx > 0) {
      							sev_str = "<span class='SEVERITY_"+sev_name+"'>" + sev_name + "</span>";
      						} 
      												
      						var descr_str = entry.descr;
      						
      						out += "<tr><td>" + sev_str+ "</td><td>"+ descr_str + "</td></tr>";
      					}
      				}
      			}							
      		}
      		out += "</table>";
      	}
      	
      */	
      	
      	
      	out += "</td></tr></table>";
      	rep_div = document.getElementById("report_entry_div");
      	if (rep_div) rep_div.innerHTML = out;						
      
      }
      
      function setEntryStatus(objname, severity, hasKnown)
      {
      	if (objname) {
      		
      		if (objname.search("DDU") >= 0) {
      			idx = getDDUindex(objname)// DDUs.push(entry);
      			id = addPadding(idx,2,'0');
      			dduID = "csc_DDU"+id;
      			m_obj = document.getElementById("cscDDU"+id);
      			if (m_obj) {
      				// addlog(objname + " " + severity, "debug");
      				if (severity >= 0) m_obj.style.background = DQM_SEVERITY[severity].color;			
      				if (hasKnown) { m_obj.style.border = "2px solid magenta"; }
      				else m_obj.style.border = "";
      				
      			}			
      		}
      		if (objname.search("ME") >= 0) {			
      			m_obj = document.getElementById(objname); 
      			if (m_obj) {
      				// addlog(objname + " " + severity, "debug");
      				if (severity >= 0) m_obj.style.background = DQM_SEVERITY[severity].color;			
      				if (hasKnown) { m_obj.style.border = "2px solid magenta"; }
      				else m_obj.style.border = "";
      			}
      		}
      	}
      }
      
      
      
      function add_show_icon()
      {
      	return "<span class='show_icon'>[Q]</span> ";
      }
      
      
      function getKnownProblemEntry(id, entry)
      {
      	if (KNOWN_PROBLEMS) {
                      ref_report = KNOWN_PROBLEMS.report;
                      if (ref_report && ref_report.length) {
                              for (var i = 0; i < ref_report.length; i++) {
                                      if (ref_report[i]) {
                                              if (id == ref_report[i].objID)
                                                      {
                                                              // return true;
                                                              if (ref_report[i].list && ref_report[i].list.length) {
                                                                      var err_list = ref_report[i].list;
                                                              
                                                                      for (var j=0; j< err_list.length; j++) {
                                                                              var ref_entry = err_list[j];
                                                                              if (ref_entry) {
                                                                                      
                                                                                      if (entry.testID == ref_entry.testID)
                                                                                      {
      											if (ref_entry.obj && entry.descr &&
                                                                                                      (entry.descr.search(ref_entry.obj) != -1 ) )
                                                                                              return ref_entry;
                                                                                      }
                                                                              }
                                                                      }
                                                              }
                                                      }
                                      }
                              }
                      }               
              }
              return "";
      }
      
      function isProblemKnown(id, entry)
      {
      	if (KNOWN_PROBLEMS) {
      		ref_report = KNOWN_PROBLEMS.report;
      		if (ref_report && ref_report.length) {
      			for (var i = 0; i < ref_report.length; i++) {
      				if (ref_report[i]) {
      					if (id == ref_report[i].objID)
      						{
      							// return true;
      							if (ref_report[i].list && ref_report[i].list.length) {
      								var err_list = ref_report[i].list;
      							
      								for (var j=0; j< err_list.length; j++) {
      									var ref_entry = err_list[j];
      									if (ref_entry) {
      										
      										if (entry.testID == ref_entry.testID)
      										{
      											if (ref_entry.obj && entry.descr &&
                                                                                                      (entry.descr.search(ref_entry.obj) != -1 ) )
      											return true;
      										}
      									}
      								}
      							}
      						}
      				}
      			}
      		}		
      	}
      	return false;
      }
      
      function isProblemRepeating(id, entry)
      {
      	if (REF_DQM_REPORT) {
      		ref_report = REF_DQM_REPORT.report;
      		if (ref_report && ref_report.length) {
      			for (var i = 0; i < ref_report.length; i++) {
      				if (ref_report[i]) {
      					if (id == ref_report[i].objID)
      						{
      							// return true;
      							if (ref_report[i].list && ref_report[i].list.length) {
      								var err_list = ref_report[i].list;
      							
      								for (var j=0; j< err_list.length; j++) {
      									var ref_entry = err_list[j];
      									if (ref_entry) {
      										
      										if (entry.testID == ref_entry.testID)
      										{
      											return true;
      										}
      									}
      								}
      							}
      						}
      				}
      			}
      		}		
      	}
      	return false;
      }
      
      function loadDQMReport(id, rep)
      {
      				
      	obj = document.getElementById(id);
      	if (obj) {
      		out = "";
      		
      		if (rep) {
      			/// if (reportWindow && !reportWindow.closed) openReportInWindow();
      			// var fullUrl = ResultsFolder+RunNumber+".plots/" + TextReport;	
      			// var out = "<b>DQM Summary Report for Run: <a href='" + fullUrl + "'>" + DQM_REPORT.run + "</a><br> (generated on "+DQM_REPORT.genDate+")</b>";
      				// <a href='' onClick='openReportInWindow();return false;'>[Open]</a></h5>";
      			out += printReportLegend();
      			out += "<table class='dqm_report'>";
      			
      			// addlog("DQM report #entries: " + DQM_REPORT.report.length, "info");
      			if (rep.run && rep.genDate) { 
      			    var a_ver = rep.version;
      			    if (!rep.version) a_ver = "1.0";
      			    out += "<tr><th class='repInfo' colspan=5><b>DQM Report for Run '" + rep.run + "' generated on '"+ rep.genDate + "' with Analysis Ver. " + a_ver  + "</b></th></tr>";
      			}
      			report = rep.report;
      			if (report && report.length) {
      				for (var i = 0; i < report.length; i++) {
      					if (report[i]) {
      						var obj_sev = -1;
      						var err_cnt = 0;
      						var filtered = true;
      						var hasKnown = false;
      						var n_out = "<tr><th class='repScope' colspan=5><b>" + report[i].name + "</b></th></tr>";
      						if (report[i].list && report[i].list.length) {
      							err_list = report[i].list;
      							
      							for (var j=0; j< err_list.length; j++) {
      								var isFiltered = true;
      								var entry = err_list[j];
      								if (entry) {
      									
      									//out += "<tr><td></td><td>" + entry.descr + "</td><td>"+entry.severity+"</td></tr>";
      									
      									var sev_idx = parseInt(entry.severity);
      									
      									var isRepeating = false;
      									var isKnown = false;
      									
      									
      									if ( ((report[i].objID.search("ME") >=0) 
      										|| ((report[i].objID.search("DDU") >=0) && fCompareDDUs)) ) 
      									{
      								
      										isRepeating = isProblemRepeating(report[i].objID, entry);
      										if (isRepeating) sev_idx=5; // REPEATING problem
      									
      										isKnown = isProblemKnown(report[i].objID, entry);
      										if (fShowKnownProblems) {
      											if (isKnown ) hasKnown = true;// sev_idx = 6; // KNOWN problem
      										}
      									}	
      									
      									var sev_name = DQM_SEVERITY[entry.severity].name;
      									
      									if (selSeverityFilter == "NONE" || selSeverityFilter == sev_name ) { err_cnt++; isFiltered = false; }									
      									
      									if (isFiltered)  {  continue};
      									
      									filtered = false; 
      									
      									if ( (sev_idx > obj_sev) 
      										&& (!fShowKnownProblems || 
      											(fShowKnownProblems && !isKnown)) ) obj_sev = sev_idx;
      									
      									var sev_str = "";
      									
      									if ( sev_idx > 0) {
      										sev_str = "<span>" + sev_name + "</span>";
      									} 
      									
      									
      									var descr_str = entry.descr;
      									if (entry.testID != "") {
      										var testInfo = findTestPlotInfo(entry.testID);
      										if (testInfo) {
      											var testFolder = getFolderName(report[i].objID, testInfo.testScope);//getFolder()
      											var testPlot = testInfo.testPlot + ".png";
      											// descr_str = entry.descr + " " +testPlot;
      											descr_str = "<a href='' onClick='Folder=\""+testFolder+"\";Scope=\""+testInfo.testScope+"\";Canvas=\""+testPlot+"\";return updateBrowserPage(\""+testPlot+"\",false,3)'>"+add_show_icon()+ entry.descr + "</a> ";
      										}
      										
      									}
      									if (((sev_idx > 0) && !isFiltered) || (selSeverityFilter == "NONE")) {
      									n_out += "<tr><td class='SEVERITY_"+sev_name+"'>" + sev_str+ "</td><td>"+ descr_str + "</td>";
      									var known = "<td></td>";
      									var repeating = "<td></td>";
      									if (isKnown) known = "<td class='SEVERITY_KNOWN_PROBLEM'>KNOWN</td>";
      									if (isRepeating) repeating = "<td class='SEVERITY_REPEATING_PROBLEM'>REPEATING</td>";
      									n_out += known+repeating+"</tr>";
      									}
      									
      								}
      							}
      						}	
      						n_out += "</tr>";
      						if (err_cnt >0 ) out += n_out;
      						// var sev_name = DQM_SEVERITY[obj_sev].name;
      						// if (selSeverityFilter == sev_name) {
      						if (filtered) obj_sev = 8;
                                                      if ( (obj_sev > 0) || hasKnown 
      							|| ((obj_sev == 0 ) && (entry.testID==""))
      							|| ((obj_sev == 0 ) && (entry.testID!="") && fMarkLowStatErrs) ) 
      							setEntryStatus(report[i].objID, obj_sev, hasKnown);
      						// }
      					// addlog(DQM_REPORT.report[i].objID, "info");
      					// setEntryStatus(DQM_REPORT.report[i]);
      					}
      				}
      			} else {
      				out = "DQM Report file for Run:" + RunName +" is empty";
      				addlog(out, "warn");
      			}
      			out += "</table>";
      		
      		} else {
      			out = "DQM Report file for Run:" + RunName +" not found";
      			addlog(out, "warn");
      		}		
      		obj.innerHTML=out;
      		// DQMReport = out;
      		setTestsStatus(getCSCId(selFolder));
      		
      	}
      }
      
      
      function loadKnownProblems(id, rep)
      {
      				
      	obj = document.getElementById(id);
      	if (obj) {
      		out = "";
      		
      		if (rep) {
      			/// if (reportWindow && !reportWindow.closed) openReportInWindow();
      			// var fullUrl = ResultsFolder+RunNumber+".plots/" + TextReport;	
      			// var out = "<b>DQM Summary Report for Run: <a href='" + fullUrl + "'>" + DQM_REPORT.run + "</a><br> (generated on "+DQM_REPORT.genDate+")</b>";
      				// <a href='' onClick='openReportInWindow();return false;'>[Open]</a></h5>";
      			out += printReportLegend();
      			out += "<table class='dqm_report'>";
      			
      			// addlog("DQM report #entries: " + DQM_REPORT.report.length, "info");
      			report = rep.report;
      			if (report && report.length) {
      				for (var i = 0; i < report.length; i++) {
      					if (report[i]) {
      						var obj_sev = 0;
      						out += "<tr><th class='repScope' colspan=3><b>" + report[i].name + "</b></th></tr>";
      						if (report[i].list && report[i].list.length) {
      							err_list = report[i].list;
      							
      							for (var j=0; j< err_list.length; j++) {
      								isFiltered = true;
      								var entry = err_list[j];
      								if (entry) {
      									
      									//out += "<tr><td></td><td>" + entry.descr + "</td><td>"+entry.severity+"</td></tr>";
      									
      									var sev_idx = parseInt(entry.severity);
      									
      																			
      									var sev_name = DQM_SEVERITY[sev_idx].name;
      									
      									if (selSeverityFilter == "NONE" || selSeverityFilter == sev_name) isFiltered = false;
      									if (isFiltered) continue;
      									
      									if (sev_idx > obj_sev) obj_sev = sev_idx;
      									
      									var sev_str = "";
      									
      									if ( sev_idx > 0) {
      										sev_str = "<span>" + sev_name + "</span>";
      									} 
      									
      									
      									var descr_str = entry.descr;
      									if (entry.testID != "") {
      										var testInfo = findTestPlotInfo(entry.testID);
      										if (testInfo) {
      											var testFolder = getFolderName(report[i].objID, testInfo.testScope);//getFolder()
      											var testPlot = testInfo.testPlot + ".png";
      											// descr_str = entry.descr + " " +testPlot;
      											descr_str = "<a href='' onClick='Folder=\""+testFolder+"\";Scope=\""+testInfo.testScope+"\";Canvas=\""+testPlot+"\";return updateBrowserPage(\""+testPlot+"\",false,3)'>"+add_show_icon()+ entry.descr + "</a> ";
      										}
      										
      									}
      									out += "<tr><td class='SEVERITY_"+sev_name+"'>" + sev_str+ "</td><td>"+ descr_str + "</td></tr>";
      								}
      							}
      						}	
      						out += "</tr>";
      						// var sev_name = DQM_SEVERITY[obj_sev].name;
      						// if (selSeverityFilter == sev_name) {
      							// setEntryStatus(report[i].objID, obj_sev);
      						// }
      					// addlog(DQM_REPORT.report[i].objID, "info");
      					// setEntryStatus(DQM_REPORT.report[i]);
      					}
      				}
      			} else {
      				out = "DQM Report file for Run:" + RunName +" is empty";
      				addlog(out, "warn");
      			}
      			out += "</table>";
      		
      		} else {
      			out = "DQM Report file for Run:" + RunName +" not found";
      			addlog(out, "warn");
      		}		
      		obj.innerHTML=out;
      		// DQMReport = out;
      		// setTestsStatus(getCSCId(selFolder));
      		
      	}
      }
      
      function getCSCId(id)
      {
      	if (selFolder.search("CSC_") >= 0) {
      		var str_id = selFolder.split("_");
      		if (str_id.length == 3) {
      			crate = "crate" + str_id[1].replace(/^[0]+/g,"");;			
      			slot = "slot" + str_id[2].replace(/^[0]+/g,"");
      			// addlog(crate + "/" +slot, "debug");
      			return findCSCFromMap(crate, slot);
      		}
      	} 
      	return selFolder;
      }
      
      function setCompareRun() {
      	var selObj = document.getElementById("compare_selection");
      	if (selObj) {
      		var selIdx = selObj.selectedIndex;
      		selRefRun = selObj.options[selIdx].value;		
      		getRefDQMReport(selRefRun);
      	}
      }
      
      function getCurrentRunNumber()
      {
         var run_n = RunNumber ;
         return run_n;
      }
      
      function getCurrentRunStartTime()
      {
         var run_start = RunStartTime ;
         return run_start;
      }
      
      function loadRunsList(r_list) 
      {	
      	
      	// out += "<div><table class='runs_table'>";
      	out = "<table class='runs_table'>";
      	out += "<th>Run</th><th>Analyzed on</th>";
      	out += "<tr class='RUN_TYPE_ONLINE'><td><a href='' id='Online' onClick='RunName=\"Online\";getTestsList();getCSCCounters();loadCSCList(\"Online\");return false;'>Live ( " + getCurrentRunNumber() +" )</a></td>";
      	out += "<td>Started at <font color='green'>" + getCurrentRunStartTime() + "</font></td></tr>";
      	if (r_list) {
      		compare_list = document.getElementById("compare_selection");
      		
      		if (compare_list) {
      			compare_list.options.length = 0;
      			var isSelected = false;
      			
      			try {
      					if (selRefRun == "noref") isSelected = true;
      					compare_list.add(new Option("Don't compare", "noref",false, isSelected), null)					
      					isSelected = false;
      					if (selRefRun == "ref") isSelected = true;
      					compare_list.add(new Option("Default Reference Run", "ref", false, isSelected), null) //add new option to end of "sample"					
      					if (selRefRun == "ref_cosmics") isSelected = true;
                                              compare_list.add(new Option("Reference Cosmics Run", "ref_cosmics", false, isSelected));
      					if (selRefRun == "ref_beam") isSelected = true;
                                              compare_list.add(new Option("Reference Collisions Run", "ref_beam", false, isSelected));
      				}
      			catch(e){ //in IE, try the below version instead of add()
      					if (selRefRun == "noref") isSelected = true;
      					compare_list.add(new Option("Don't compare", "noref"));
      					isSelected = false;
      					if (selRefRun == "ref") isSelected = true;
      					compare_list.add(new Option("Default Reference Run", "ref", false, isSelected));
      				        if (selRefRun == "ref_cosmics") isSelected = true;
                                              compare_list.add(new Option("Reference Cosmics Run", "ref_cosmics", false, isSelected));
                                              if (selRefRun == "ref_beam") isSelected = true;
                                              compare_list.add(new Option("Reference Collisions Run", "ref_beam", false, isSelected));
      				}
      				if (selRefRun == "") {
      					selRefRun = "noref";
      					// getRefDQMReport(selRefRun);
      				}
      			}
      		// addlog("runs", "info");
      		runs_count = 0;
      		for (var i = 0; i< r_list.length; i++) {
      			isSelected = false;
      			child = [];		
      			child=r_list[i];
      			if (!child) continue;
      			// remove ref.root from list
      			if (child[0].search(/ref.root/g) != -1) continue;
      			if (child[0].search(/ref_beam.root/g) != -1) continue;
      			if (child[0].search(/ref_cosmics.root/g) != -1) continue;
      			run_descr = child[0].replace(/.root/g,'');
      			run_num = child[0].substr(0, child[0].search(/.root/g));
      			run_time = child[0].substr(child[0].search(/\(/g),child[0].search(/\)/g));
      			// if (i==0) RunNumber = run_num;
      			// addlog(run_descr, "info");
      			run_type = "RUN_TYPE_UNKNOWN";
      			runs_count = runs_count + 1;
      		        
      			out += "<tr><td class='"+run_type+"'><a href='' id='"+run_num+"' onClick='RunName=\""+run_num+"\";getTestsList();getCSCCounters();loadCSCList(\""+run_num+"\");return false;'>"+run_num+"</a></td><td>"+run_time+"</td></tr>";
      			if (selRefRun == run_num) isSelected = true;
      			if (compare_list)
      				{
      					try 
      					{
      						
      						compare_list.add(new Option(run_num, run_num, false, isSelected), null) //add new option to end of "sample"					
      					}
      					catch(e){ //in IE, try the below version instead of add()
      						compare_list.add(new Option(run_num, run_num, false, isSelected));
      					}
      					
      				
      				}
      			
      		}
      		setRunsCount(runs_count);
      		
      	} 
      	
      	out += "</table>";
      	obj = document.getElementById("runs_list");
      	if (obj) obj.innerHTML = out;
      	
      	
      }	
      
      function setRunsCount(cnt)
      {
          obj = document.getElementById("runs_count");
          if (obj) obj.innerHTML = cnt;
      }
      
      function setRunsFilter()
      {
              out = "<table class='dqm_report'><tr>";
      	out += "<td colspan=5><b>Runs Count: <font color='blue'><span id='runs_count'></span></font></b></td></tr></tr>";
              out += "<td><b>Run Types </b></td> ";
              for (var i=0; i<RUN_TYPES.length; i++) {
                      out += "<td><span title='"+RUN_TYPES[i].descr+"' class='RUN_TYPE_"+RUN_TYPES[i].type+"'>" + RUN_TYPES[i].name + "</span></td> ";
              }
              out += "</tr></table>";
      	obj = document.getElementById("run_filter");
              if (obj) obj.innerHTML = out;
      }
      
      
      function getRunsList()
      {
      	var fullUrl = baseURL+ RunsList;
      	
      	
      	var req=false;
      	if (window.XMLHttpRequest) { 
      		/*
      		try {
      	    		netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite");
      	   	} catch (e) {
      	    		alert("Permission UniversalBrowserRead denied.");
      	   	}
      		*/
      	    req = new XMLHttpRequest();    
      	   
      	} else if (window.ActiveXObject) {    
      		//req = new ActiveXObject("Microsoft.XMLDOM");
      	    req = new ActiveXObject((navigator.userAgent.toLowerCase().indexOf('msie 5') != -1) ? "Microsoft.XMLHTTP" : "Msxml2.XMLHTTP");
      		// var req = new ActiveXObject("Microsoft.XMLHTTP");
      	}
          req.open("GET",fullUrl,true); // true= asynch, false=wait until loaded    
      	
          req.onreadystatechange = function() {
              if (req.readyState == 4) {
      			if (req.status==200) {	        
      				var reply = req.responseText;
      				// Need to strip malformed array string to satisfy IE7
      				reply = reply.replace(/,]/g,"]");
      				reply = reply.replace("var ","");
      	        	window.eval(reply);
      				loadRunsList(RUNS);
      				selectObject(RunName,false,2);
      				// addlog(reply, 'debug');
      				// updateBrowserPage(Canvas,false,3);				
      				// updateBrowserPage(id,false,2);
      	    	} else if (req.status==404) {				
      				addlog("Can not load " + fullUrl, 'error');
      				RUNS=false;
      				loadRunsList(RUNS);
      				selectObject(RunName,false,2);
      	    	}
      						
      		}
          }
      	req.send(null);	
      	setTimeout('getRunsList()', 60000);
      	return false;
      }
      
      function getDQMReport()
      {
      	var fullUrl = baseURL + JSONReport+"?run="+RunName;
      	
      	
      	var req=false;
      	if (window.XMLHttpRequest) { 
      		/*
      		try {
      	    		netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite");
      	   	} catch (e) {
      	    		alert("Permission UniversalBrowserRead denied.");
      	   	}
      		*/
      	    req = new XMLHttpRequest();    
      	   
      	} else if (window.ActiveXObject) {    
      		//req = new ActiveXObject("Microsoft.XMLDOM");
      	    req = new ActiveXObject((navigator.userAgent.toLowerCase().indexOf('msie 5') != -1) ? "Microsoft.XMLHTTP" : "Msxml2.XMLHTTP");
      		// var req = new ActiveXObject("Microsoft.XMLHTTP");
      	}
          req.open("GET",fullUrl,true); // true= asynch, false=wait until loaded    
      	
          req.onreadystatechange = function() {
              if (req.readyState == 4) {
      			if (req.status==200) {
      				DQM_REPORT = false;
      				
      				var reply = req.responseText;
      				// Need to strip malformed array string to satisfy IE7
      				reply = reply.replace(/,]/g,"]");
      				reply = reply.replace("var ","");
      				window.eval(reply);				
      				loadDQMReport("report_div", DQM_REPORT);
      				
      				
      	    	} else if (req.status==404) {
      				DQM_REPORT = false;
      				addlog("Can not load " + fullUrl, 'warn');
      				// loadTextReport("report_div");
      				loadDQMReport("report_div", DQM_REPORT);
      	    	}
      						
      		}
          }
      	req.send(null);	
      	// setTimeout('getDQMReport()', 20000);
      	return false;
      }
      
      function getRefDQMReport(run)
      {
      	
      	var fullUrl = baseURL + JSONReport+"?run="+run;
      	
      	if (run == "noref") {
      		REF_DQM_REPORT = false;
      		loadDQMReport("report_div", DQM_REPORT);
      		return false;
      	}
      	
      	
      	var req=false;
      	if (window.XMLHttpRequest) { 
      		/*
      		try {
      	    		netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite");
      	   	} catch (e) {
      	    		alert("Permission UniversalBrowserRead denied.");
      	   	}
      		*/
      	    req = new XMLHttpRequest();    
      	   
      	} else if (window.ActiveXObject) {    
      		//req = new ActiveXObject("Microsoft.XMLDOM");
      	    req = new ActiveXObject((navigator.userAgent.toLowerCase().indexOf('msie 5') != -1) ? "Microsoft.XMLHTTP" : "Msxml2.XMLHTTP");
      		// var req = new ActiveXObject("Microsoft.XMLHTTP");
      	}
          req.open("GET",fullUrl,true); // true= asynch, false=wait until loaded    
      	
          req.onreadystatechange = function() {
              if (req.readyState == 4) {
      			if (req.status==200) {
      				REF_DQM_REPORT = false;
      				
      				var reply = req.responseText;
      				// Need to strip malformed array string to satisfy IE7
      				reply = reply.replace(/DQM_REPORT/g,"REF_DQM_REPORT");
      				reply = reply.replace(/,]/g,"]");
      				reply = reply.replace("var ","");
      				window.eval(reply);
      				// addlog("Loaded report for " + run, "debug");
      				loadDQMReport("report_div", DQM_REPORT);
      				
      				
      	    	} else if (req.status==404) {
      				REF_DQM_REPORT = false;
      				addlog("Can not load " + fullUrl, 'warn');
      				// loadTextReport("report_div");
      				loadDQMReport("report_div", DQM_REPORT);
      	    	}
      						
      		}
          }
      	req.send(null);	
      	// setTimeout('getDQMReport()', 20000);
      	return false;
      }
      
      
      function getVMECrateName(crate)
      {
      	if (VMEMAP && VMEMAP.length) {
      		for (var i=0; i<VMEMAP.length; i++) {
      			if (crate == "crate"+VMEMAP[i][1]) {
      				return VMEMAP[i][0];
      			}			
      		}
      	}
      }
      
      function getCountersForCSC(id)
      {
         cntrs=CSC_COUNTERS;
         if (cntrs && cntrs.length >0) {
             cscs = cntrs[0];
             cscid = findHWId(id);
             if (cscid != "") {
      	 for (var i=1; i<cscs.length; i++) {
                  if (!cscs[i] || (cscs[i][0] != cscid)) continue;
      	    stats = cscs[i][1];
      
      	    stats_out="";
                  alct=0;
                  clct=0;
                  cfeb=0;
                  bad=0;
                  dmb=0;
                                      
                  if (stats && stats.length)
                     {
                       for (var j=0; j<stats.length; j++) {
                          tag = stats[j][0];
                          if (tag=='ALCT') alct=parseInt(stats[j][1]);
                          if (tag=='CLCT') clct=parseInt(stats[j][1]);
                          if (tag=='CFEB') cfeb=parseInt(stats[j][1]);
                          if (tag=='BAD') bad=parseInt(stats[j][1]);
                          if (tag=='DMB') dmb=parseFloat(stats[j][1]);
                         }
                     }
                  if (dmb) {
                      bcolor='white';
      		color="black";
      		if ((100*bad/dmb)>10) { color="red"; bcolor=badclr; }
                      stats_out += "[<b><font color='blue'>DMB Events</font></b>: <b>"+dmb+"</b>] ";
      		stats_out += "[<b><font color='red'>Bad: " + "</font></b><font color='"+color+"'><b>"+bad+"</b> ("+(100*(bad/(dmb))).toFixed(1)+"%)</font>] ";
      
                      color="black";
                      badclr='#FFD0D0';
                      if ((100*alct/(dmb-bad))<30) { color="red"; cnt_bad_alct++;}
                      stats_out+="[<b><font color='green'>ALCT</font></b>: <b>" + alct + "</b><font color='"+color+"'> ("+(100*(alct/dmb)).toFixed(1)+"%)</font>] ";
                      color="black";
                      if ((100*clct/(dmb-bad))<30) { color="red"; cnt_bad_clct++;}
                      stats_out+="[<b><font color='green'>CLCT</font></b>: <b>" + clct+ " </b><font color='"+color+"'> ("+(100*(clct/dmb)).toFixed(1)+"%)</font>] ";
                      color="black";
                      if ((100*cfeb/(dmb-bad))<30) { color="red"; cnt_bad_cfeb++;}
                      stats_out+="[<b><font color='green'>CFEBs</font></b>: <b>" + cfeb + "</b><font color='"+color+"'> ("+(100*(cfeb/dmb)).toFixed(1)+"%)</font>]";// ;Bad:"+bad;
                                      
                  } else { stats_out += "DMB Events: <b>" + dmb + "</b>";}
      
      	    return stats_out;
      	 }
             } 
         }
         return "";
      }
      
      function showCSCCounters()  
      {
      	cntrs=CSC_COUNTERS;
      	csc_map = CSCMAP;
      	var obj=document.getElementById("csccounters_div");
      	if (obj) {
      		var out="<table>";
      			if (cntrs && cntrs.length >0) {
      			cscs = cntrs[0];								
      			var crate=0;
      			var slot=0;
      			cnt_bad_alct=0;
      			cnt_bad_clct=0;
      			cnt_bad_cfeb=0;
      			cnt_bad_events=0;
      			for (var i=1; i<cscs.length; i++) {
      				if (!cscs[i]) continue;
      				var csc = cscs[i][0];	
      				stats = cscs[i][1];
      				n_crate = parseFloat(csc.substring(4,7));
      				if (n_crate != crate ) { 
      					crate_str=getVMECrateName("crate"+n_crate) + ": crate"+n_crate;
      					out+="</tr><tr><td class='node_info'><b>"+crate_str+"</b></td>";
      					crate=n_crate;
      				}
      				slot = parseFloat(csc.substring(8,10));
      				cscid = "";
      				for (var k=0; k<csc_map.length; k++) {
      						if (!csc_map[k]) continue;
      						map_entry = csc_map[k];
      						if ((map_entry[0] == "crate"+crate) && (map_entry[1] == "slot"+slot)) {cscid = map_entry[2];}
      				}
      				
      				stats_out="";
      				alct=0;
      				clct=0;
      				cfeb=0;
      				bad=0;
      				dmb=0;
      				
      				
      				
      				if (stats && stats.length)
      				{
      					for (var j=0; j<stats.length; j++) {
      						// stats_out+= stats[j][1]+",";
      						tag = stats[j][0];
      						if (tag=='ALCT') alct=parseInt(stats[j][1]);
      						if (tag=='CLCT') clct=parseInt(stats[j][1]);
      						if (tag=='CFEB') cfeb=parseInt(stats[j][1]);
      						if (tag=='BAD') bad=parseInt(stats[j][1]);
      						if (tag=='DMB') dmb=parseFloat(stats[j][1]);
      					}
      				}
      				if (dmb) {
      					bcolor='white';
      					color="black";
      					badclr='#FFD0D0';
      					if ((100*alct/(dmb-bad))<30) { color="red"; cnt_bad_alct++;}
      					stats_out+="A:<font color='"+color+"'>"+(100*(alct/(dmb-bad))).toFixed(1)+"</font>;";
      					color="black";
      					if ((100*clct/(dmb-bad))<30) { color="red"; cnt_bad_clct++;}
      					stats_out+="T:<font color='"+color+"'>"+(100*(clct/(dmb-bad))).toFixed(1)+"</font>;";
      					color="black";
      					if ((100*cfeb/(dmb-bad))<30) { color="red"; cnt_bad_cfeb++;}
      					stats_out+="C:<font color='"+color+"'>"+(100*(cfeb/(dmb-bad))).toFixed(1)+"</font>";// ;Bad:"+bad;
      				
      					color="black";
      					if ((100*bad/dmb)>10) { color="red"; bcolor=badclr; cnt_bad_events++;}
      					out += "<td style='background-color: "+bcolor+"'><b>(dmb"+slot+") "+cscid+"</b><br>#E:"+dmb+";"					
      					out +=" #B:<font color='"+color+"'>"+bad+"("+(100*(bad/(dmb))).toFixed(1)+")</font><br>"+stats_out+"</td>";
      				}
      				// slots = crates[i][1];			
      				out += "";
      				// addlog(csc, "debug");
      			}		
      		}		
      		out+= "</table>";	
      		out= "<table><tr><td class='node_info'>Summary (#CSCs with failed efficiencies)</td><td class='node_info'>Bad events: <b>"+cnt_bad_events+"</b></td><td class='node_info'>ALCT: <b>"+cnt_bad_alct+"</b></td><td  class='node_info'>TMB/CLCT: <b>"+cnt_bad_clct+"</b></td><td  class='node_info'>CFEB: <b>"+cnt_bad_cfeb+"</b></td></tr></table>"+out;
      		out+= "<table><tr><td class='node_info'>Legend: #E - #of Events; #B - #of Bad Events; A - ALCT; T - TMB/CLCT; C - CFEB Efficiencies in %</td></tr></table>";
      		obj.innerHTML=out;
      		return;
      		try {
      						title="CSC Counters Stats";
      						var generator=window.open('','counters','height='+800+',width='+1000+',resizable=no');						
      						if (window.focus) {generator.focus()} 
      						generator.resizeTo(1000, 800);
      						generator.document.write('<html><head><title>'+title+'</title>');
      						generator.document.write("<style>body {color: #000000; background-color: #9090FF;margin: 2px;font-family:Arial;	overflow: auto;}"+
      						"span.winTitle {	margin: 0;font-size: 12px;font-weight: bold;text-decoration: none;color: #000000;}"+
      						"fieldset {background-color: #ddd;	border-style: solid;border-width: 1px;border-color: black;margin: 2px;padding: 2px;}"+
      						"legend {border-style: solid;border-width: 1px;background-color:  #C0C0FF;}td.node {background-color: white; text-align: left; font-size: 8pt;"+
      						"padding: 0px;}</style>");
      						generator.document.write('</head><body>');
      						generator.document.write("<fieldset><legend><span class='winTitle'>"+title+"</span></legend>");
      						generator.document.write(out);
      						generator.document.write("</fieldset>");
      						// generator.document.write('<p><a href="javascript:self.close()">Close</a> the popup.</p>');
      						generator.document.write('</body></html>');
      						generator.document.close();
      					  } 
      					  catch (exc){
      					}
      	}
      }
      
      function updateSysStatus() 
      {
      	var obj=document.getElementById("sysstatus_div");
      	if (obj) {
      		getNodesListDelay-=2;
      		if (getNodesListDelay<0) getNodesListDelay=0;
      		getCSCListDelay-=2;
      		if (getCSCListDelay<0) getCSCListDelay=0;
		
      		var out="<table><tr>";
      	
//      	        out+= "<td class='td_status'><input class='button' type='button' name='action' style='background-color: #90ff90; font: bold 8pt Arial;' value='Show All' onClick='return showAllNodesStatuses();' title='Click to show all EmuMonitors statuses'></td>";	
      		out+= "<td><b>Total:</b></td><td class='td_status'> #DDUs: <b>"+ numDDUs+"</b></td><td class='td_status'> #CSCs: <b>"+numCSCs+"</b></td>";
      		out+= "<td class='td_status'>DAQ Evts: <b>"+totalDAQevents+"</b></td><td class='td_status'>DQM Evts: <b>"+totalDQMevents+"</b></td>"
      		out+= "<td class='td_status'>CSC blocks: <b>"+totalCSCblocks+"</b></td>";
		out+= "<td class='td_status'><a href='' onClick='getNodeHistory(\"\",\"averageRate\"); return false;' title='Click to view Total DQM Rate history'>DQM Rate: <b>"+totalDQMrate+"</b></a></td>";
      		out+= "<td class='td_status'><a href='' onClick='getNodeHistory(\"\",\"cscRate\"); return false;' title='Click to view Total CSC Rate history'>CSC Rate: <b>"+totalCSCrate+"</b></a></td>";
      		out+= "<td class='td_status'>Upd Nodes in <b>"+getNodesListDelay+"</b> sec</td><td class='td_status'>Upd CSC List in <b>"+getCSCListDelay+"</b> sec</td>";
      	        out+= "</tr></table>";
      		
      		obj.innerHTML=out;
      	}
      	setTimeout('updateSysStatus()', 2000);
      }
      
      function showAllNodesStatuses()
      {
        try 
        {
      
            var out="";
            var nodes=NODES_LIST;
            if (nodes && nodes.length>1) {
                 out +="<table class='nodes_table'>";
                 // Show Table Header
                 if (nodes.length && nodes[0] && nodes[0].length) {
                    for (i=0; i< nodes[0].length-3; i++) {
                        out+="<th class='node'>"+nodes[0][i]+"</th>";
                    }
      	      out+="<th class='node'>"+nodes[0][nodes[0].length-1]+"</th>";
                 }
               for (i=1; i<nodes.length; i++) {
      	   var tag="EmuMonitor-"+i;
                 for (idx=1; idx<nodes.length; idx++) {
      	      if (nodes[idx][0] != tag) continue;
                    if (nodes[idx] && nodes[idx].length) {
                       // Show Node Status 
                      out+="<tr>";
                      out+="<td class='node'><a target='shownode' href='"+nodes[idx][1]+"'>"+nodes[idx][0]+"</a></td>";
                      state = nodes[idx][2];
                      id = 'node_'+node;
                      var color='white';
                      if (state.search("Enabled") >=0) {color='#90ff90';}
                      else if (state.search("Halted") >=0) {color='#ff9090';}
                      else if (state.search("Ready") >=0) {color='#ffff90';}
                      else if (state.search("Unknown") >=0) {color='909090';}
      
                      out +="<td class='node' style='background-color: "+color+"'>"+state+"</td>";
                      for (j=3; j<nodes[idx].length-3; j++) {
                         var value = nodes[idx][j];
                         // Fix run start time. should be UTC
                         if (j==4) value = value.replace("CEST", "UTC");
      		   if (j>=5 && j<=9) { 
      			var diff = 0;
      			color = 'black';
      			if (nodes_prev && nodes_prev[idx][j] 
      				&& (nodes[idx][3] == nodes_prev[idx][3]) 
      				&& (nodes[idx][4] == nodes_prev[idx][4])  ) { 
      				diff = nodes[idx][j]-nodes_prev[idx][j];
      				if (diff<0) { color="red";}
      				else if (diff>0) {color="green"; diff = "+"+diff;}
      			}
      			value = value + " (<font color='"+color+ "'>" + diff +"</font>)";
      		   }
      		
                         out+="<td class='node'>"+value+"</td>";
                      }
      		out+="<td class='node'>"+nodes[idx][nodes[idx].length-1]+"</td>";
                      out+="</tr>";
                   }
                }
              }
      	  out+="</table>";
      
      	  out+="<table><tr>";
                out+= "<td class='node'><b>Total:</b></td><td class='node'> #DDUs: <b>"+ numDDUs+"</b></td><td class='node'> #CSCs: <b>"+numCSCs+"</b></td>";
                out+= "<td class='node'>DAQ Evts: <b>"+totalDAQevents+"</b></td><td class='node'>DQM Evts: <b>"+totalDQMevents+"</b></td>"
                out+= "<td class='node'>CSC blocks: <b>"+totalCSCblocks+"</b></td><td class='node'>DQM Rate: <b>"+totalDQMrate+"</b></td>";
                out+= "<td class='node'>CSC Rate: <b>"+totalCSCrate+"</b></td>";
                out+= "</tr></table>";
            }
       
           nodes_prev = nodes;
      
      
      
           title="Monitoring Nodes Status"; 
           var generator=window.open("","all_nodes_status","location=0,status=0,width=1100,height=800,resizable=yes");
           if (window.focus) {generator.focus()}
           generator.resizeTo(1100, 800);
           generator.document.write('<html><head><title>'+title+'</title>');
           generator.document.write("<style>body {color: #000000; background-color: #9090FF;margin: 2px;font-family:Arial; overflow: auto;}"+
           "span.winTitle {        margin: 0;font-size: 12px;font-weight: bold;text-decoration: none;color: #000000;}"+
           "fieldset {background-color: #ddd;      border-style: solid;border-width: 1px;border-color: black;margin: 2px;padding: 2px;}"+
           "legend {border-style: solid;border-width: 1px;background-color:  #C0C0FF;}td.node {background-color: white; text-align: right; font-size: 8pt;"+
           "padding: 1px;}"+
           "a, A:link, a:visited, a:active, A:hover {color: #000000; font-weight: bold; text-decoration: none;outline-style: none;}"+
           "th.node {background-color: lightblue; text-align: center; font-size: 8pt;"+
           "padding: 1px;}</style>");
           generator.document.write('</head><body>');
           generator.document.write("<fieldset><legend><span class='winTitle'>"+title+"</span></legend>");
           generator.document.write(out);
           generator.document.write("</fieldset>");
           // generator.document.write('<p><a href="javascript:self.close()">Close</a> the popup.</p>');
           generator.document.write('</body></html>');
           generator.document.close();
          
           all_nodes_status_window = generator;     
      
           }
        catch (exc){
        }
        return false;
      }
      
      function updateCSCMappings()
      {
      	c_list = CSC_LIST;
      	showCSCTable("csctable_div");
      	showDDUTable("ddutable_div");
      	//resetCSCTable('csc_table');
      	
      	numCSCs=0;
      	numDDUs=0;
      	if (c_list.length > 0) {
      		c_tree = c_list[0];
      		for ( var j=1; j<c_tree.length; j++) {
      			key = c_tree[j][0];
      			entries = c_tree[j][1];
      			if (entries.length >0) {
      				for (k=0; k<entries.length; k++) {
      					enableCSCTableEntry(key, entries[k]);
      				}
      			}
      		}		
      	}
      	// updateSysStatus();
      	// selectFolder(Folder);
      }
      
      function getDDUindex(id)
      {
      	ddu_map = DDUMAP;
      	if (ddu_map) {
      		for (i=0; i< ddu_map.length; i++) {
      			if (ddu_map[i] && ddu_map[i].length) {
      				if (id == ddu_map[i][0]) return ddu_map[i][1];
      			}
      		}
      	} else {
      		return DDUs.push(id);
      	}
      }
      
      function enableCSCTableEntry(entry_key, entry)
      {
      	obj_sel = selectedObjectList[4];
      	var r_link=document.getElementById("RunLink");
      	// if (r_link) r_link.innerHTML = "<a class='RLink' href=''>Run: " + RunNumber + "</a>";
              if (r_link) {
      		if (RunName == "Online")
      		{
      		  r_link.innerHTML = "<a class='RLink' href=''>Run: " + RunNumber + " (Online)</a>";
      		} else {
      		  r_link.innerHTML = "<a class='RLink' href=''>Run: " + RunName + "</a> [<a href='getROOTFile?file="+ RunName +".root'>Download ROOT File</a>]";
      		}
      	  }
      	if (entry_key.search("EMU") >= 0) {
      		obj = document.getElementById("cscCommon");
      		if (obj) {
      			obj.style.background = 'lightgreen';			
      			val = obj.innerHTML;
      			emuID = "csc_" + entry;
      			// emuLink="<a href='#' id='" + emuID+ "' onClick='Folder=\""+entry+"\"; return loadFrame(\""+emuID+"\",false, 4)'>Common</a>";
      			emuLink="<a href='' id='" + emuID+ "' onClick='Folder=\""+entry+"\"; selectSystemFolder(\""+entry+"\"); setTestsStatus(\""+entry+"\");return loadPlot();'>EMU Summary</a>";
      			obj.innerHTML = emuLink;
      			if (obj_sel && (obj_sel.id.search(emuID) >= 0 )) {
      				Folder = entry;
      				selectSystemFolder(entry);
      				// select(emuID, false, 4);
      				// addlog(obj_sel.id, "info");				
      			}
      		}
      	}
      	if (entry_key.search("DDU") >= 0) {
      		idx = getDDUindex(entry)// DDUs.push(entry);
      		id = addPadding(idx,2,'0');
      		dduID = "csc_"+entry;
      		obj = document.getElementById("cscDDU"+id);
      		if (obj) {
      			numDDUs++;
      			obj.style.background = 'lightgreen';
      			val = obj.innerHTML;
      			// emuLink="<a href='#' id='" + dduID+ "' onClick='Folder=\""+entry+"\"; return loadFrame(\""+dduID+"\",false, 4)'>"+idx+"</a>";
      			dduLink="<a href='' id='" + dduID+ "' onClick='Folder=\""+entry+"\"; selectSystemFolder(\""+entry+"\"); showConnectedCSCs(\""+idx+"\"); setTestsStatus(\""+entry+"\");return loadPlot();'>"+idx+"</a>";
      			obj.innerHTML = dduLink;
      			if (obj_sel && (obj_sel.id == dduID)) {
      				Folder = entry;
      				selectSystemFolder(entry);
      				// addlog("Found " + obj_sel.id + ": "+entry_key+"/"+entry, "debug");
      				// select(dduID, false, 4);
      				// addlog(obj_sel.id, "info");				
      			}
      		}
      	}
      	else if (entry_key.search("crate") >=0) {
      		cscName = findCSCFromMap(entry_key, entry);
      		obj = document.getElementById(cscName); 
      		if (obj) {
      			numCSCs++;
      			obj.style.background = 'lightgreen';
      			val = obj.innerHTML;
      			// csc = entry_key+"/"+entry;
      			var csc = makeCSCid(entry_key, entry);
      			cscID = "csc_" + csc;
      			// csclink="<a href='#' id='" + cscID+ "' onClick='Folder=\""+csc+"\"; return loadFrame(\""+cscID+"\",false, 4)'>"+val+"</a>";
      			csclink="<a href='' id='" + cscID+ "' onClick='Folder=\""+csc+"\"; selectSystemFolder(\""+csc+"\"); findLinkedDDU(\""+cscName+"\"); setTestsStatus(\""+cscName+"\");return loadPlot();'>"+val+"</a>";
      			obj.innerHTML = csclink;
      			addToFoldersShowList("All CSCs", csc, cscName);
      			if (obj_sel && (obj_sel.id == cscID)) {
      				Folder = csc;
      				selectSystemFolder(csc);
      				// addlog("Found " + obj_sel.id + ": "+entry_key+"/"+entry, "debug");
      				// selectFolder(Folder);
      				// select(cscID, false, 4);
      				// addlog(obj_sel.id, "info");				
      			}
      			
      		}	
      	} 
      	//addlog(selected_list[4], "info");
      }
      
      function findCSCFromMap(crate, slot, m_list)
      {
      	
      	m_list = CSCMAP;
      	if (m_list.length>0) {
      		for (var i=0; i<m_list.length; i++) {
      			if ( (m_list[i][0] == crate) && 
      				(m_list[i][1] == slot) )
      			   return m_list[i][2];		
      		}	
      	}
      	return "";
      }
      
      
      function selectNode(id)
      {
      	node = "node_"+id;
      	selectObject(node, false, 6);	
      	selNode = id;
      	return false;
      }
      
      function selectSystemFolder(id)
      {
      	isFolderValid=true;	
      	hw_id = "hw_"+id;
      	csc_id = "csc_"+id;
      	selectObject(hw_id, false, 1);
      	selectObject(csc_id, false, 4);
      	selFolder=id;
      	// addlog(selFolder, "debug");
      	return false; 
      }
      
      function selectTest(id, b_select)
      {
      	isFolderValid=true;	
      	
      	selectObject(id, b_select, 3);
      	// addlog(selected_list[idx].id, "debug");
      	// loadPlot();
      	return false; 
      }
      
      function updateBrowserPage(id, f_select, idx)
      {
      	isFolderValid=true;		
      	selectObject(id, f_select, idx);
      	// addlog(selected_list[idx].id, "debug");
      	loadPlot();
      	
      	return false; 
      }
      
      
      function decImageHeight()
      {	
      	imgHeight = imgHeight-imgSizeStep;
      	if (imgHeight<minImageHeight) imgHeight=minImageHeight;
      	obj = document.getElementById("imageHeight");
      	if (obj) obj.value = imgHeight;
      			
      			
      	// loadPlot();
      }
      
      function incImageHeight()
      {
      	imgHeight = imgHeight+imgSizeStep;
      	if (imgHeight>maxImageHeight) imgHeight = maxImageHeight;	
      	obj = document.getElementById("imageHeight");
      	if (obj) obj.value = imgHeight;
      	
      	
      	// loadPlot();
      }
      
      function decImageWidth()
      {	
      			
      	imgWidth = imgWidth-imgSizeStep;
      	if (imgWidth<minImageWidth) imgWidth = minImageWidth;	
      	obj = document.getElementById("imageWidth");
      	if (obj) obj.value = imgWidth;
      			
      	//loadPlot();
      }
      
      function incImageWidth()
      {
      	
      	imgWidth = imgWidth+imgSizeStep;
      	if (imgWidth>maxImageWidth) imgWidth = maxImageWidth;	
      	obj = document.getElementById("imageWidth");
      	if (obj) obj.value = imgWidth;
      	
      	//loadPlot();
      }
      
      function selectPlotMode()
      {
      	var obj = document.getElementById("openExternal");
      	if (obj) {
      		if (obj.checked) {
      			fOpenExternal=true;
      		} else {
      			fOpenExternal=false;
      		}
      	}
      }
      
      function selectCompareDDUMode()
      {
      	var obj = document.getElementById("dducompare");
      	if (obj) {
      		if (obj.checked) {
      			fCompareDDUs=true;
      		} else {
      			fCompareDDUs=false;
      		}
      		loadDQMReport("report_div", DQM_REPORT);
      	}
      }
      
      function selectMarkLowStatsErrs()
      {
              var obj = document.getElementById("marklowstats");
              if (obj) {
                      if (obj.checked) {
                              fMarkLowStatErrs=true;
                      } else {
                              fMarkLowStatErrs=false;
                      }
                      loadDQMReport("report_div", DQM_REPORT);
              }
      }
      
      function selectShowKnownMode()
      {
      	var obj = document.getElementById("showknown");
      	if (obj) {
      		if (obj.checked) {
      			fShowKnownProblems=true;
      		} else {
      			fShowKnownProblems=false;
      		}
      		loadDQMReport("report_div", DQM_REPORT);
      	}
      }
      
      function selectShowReferenceMode()
      {
      	var obj = document.getElementById("showReference");
      	if (obj) {
      		if (obj.checked) {
      			fShowReference=true;
      			loadPlot();
      		} else {
      			fShowReference=false;
      		}
      	}
      }
      
      function selectUpdateMode()
      {
      	var obj = document.getElementById("autoUpdateMode");
      	if (obj) {
      		if (obj.checked) {
      			fAutoUpdatePlot=true;
      			updatePlots();
      		} else {
      			fAutoUpdatePlot=false;
      		}
      	}
      }
      
      function selectObject (id, f_deselect, idx) {
      	var obj = get_element(id);
      	if (obj) {
      		
      		if(!f_deselect) {
      			var o_olditem = selectedObjectList[idx];
      			selectedObjectList[idx] = obj;
      			if (o_olditem) selectObject(o_olditem.id, true, idx);
      			
      		}
      		if (obj.style) {
      			obj.style.fontWeight = f_deselect ? 'normal' : 'bold';
      			obj.style.color = f_deselect ? '#000000' : '#0000ff';
      		}
      	} 
      }
      
      var timerID = 0;
      var tStart  = null;
      
      var showList = new Array();
      var showIdx = 0;
      var folderIdx = 0;
      var foldersSList = "";
      var updateDelay = 5;
      
      function setSelectedList() {
      	var selObj = document.getElementById("showlist_selection");
      	if (selObj) {
      		var selIdx = selObj.selectedIndex;
      		selList = selObj.options[selIdx].value;
      		showSlideShowList(selList);
      		showList = testsShowLists[selList];
      	}
      }
      
      function setSelectedFoldersList() {
      	var selObj = document.getElementById("folders_selection");
      	if (selObj) {
      		var selIdx = selObj.selectedIndex;
      		selList = selObj.options[selIdx].value;
      		foldersSListIdx = selIdx;
      		foldersSList = selList;
      		// addlog(selList, "info");
      		// folderList = foldersShowLists[selList];
      	}
      }
      
      
      
      
      function showNextSlide()
      {
      	showIdx++;
      	showSlide();
      }
      
      function showPrevSlide()
      {
      	
      	
      	if (showIdx==0) showIdx=showList.length;
      	showIdx--;
      	showSlide();
      }
      function showSlide()
      {
         if (showIdx >= showList.length || showIdx<0) { showIdx = 0;}
         if (showList[showIdx]) { 
      	Canvas = showList[showIdx][0];
      	Scope = showList[showIdx][2];
      	}
         
         obj = document.getElementById("currentTest");
         // addlog(Canvas, "debug");
         loadPlot();
         selectTest(Canvas, false);
         selectSystemFolder(Folder);
         //loadFrame(Canvas, false, 3);
         selectObject("ssid_"+showIdx, false, 5);
         if (obj) obj.innerHTML = Canvas;
         
      }
      
      function updateSlideShowTimer() {
         if(timerID) {
            clearTimeout(timerID);
            clockID  = 0;
         }
      
         if(!tStart)
            tStart   = new Date();
      
         var   tDate = new Date();
         var   tDiff = tDate.getTime() - tStart.getTime();
      
         
         tDate.setTime(tDiff);
      /*
         document.theTimer.theTime.value = "" 
                                         + tDate.getMinutes() + ":" 
                                         + tDate.getSeconds();
         */
         
         
         showSlide();
         
         if (foldersSListIdx > 0) 
         {
      	 if (loopFoldersFirst) 
      	 {
      		fList = foldersShowLists[foldersSList];
      		if (folderIdx >= fList.length-1) 
      		{
      			folderIdx = 0;
      			showIdx++;
      		 } else {
      			folderIdx++;
      		 }
      		 Folder =  fList[folderIdx][0];
      		 
      	 };
      	 // addlog(Folder,"debug");
         } else {
      	showIdx++;
         }
         timerID = setTimeout("updateSlideShowTimer()", updateDelay*1000);
      }
      
      function startSlideShow() {
         tStart   = new Date();
         obj = document.getElementById("updateInterval");
         if (obj) {
      	val = parseInt(obj.value);
      	if (!isNaN(val) && val <=30) updateDelay = val;
         }
         	
      	
         showSlideShowList();
         if (foldersShowLists[foldersSList][0]) {
      		Folder = foldersShowLists[foldersSList][0][0];
      		folderIdx = 0;
      	}
         
         
         timerID  = setTimeout("updateSlideShowTimer()", updateDelay*1000);
      }
      
      function stopSlideShow() {
         if(timerID) {
            clearTimeout(timerID);
            timerID  = 0;
         }
         tStart = null;
      }
      
      function resetSlideShow() {
         tStart = null;
         showIdx=0;
         folderIdx = 0;
      
         // document.theTimer.theTime.value = "00:00";
      }
      
      
      function initSlideShowList()
      {
      	document.write('<label>Tests:</label>');
      	document.write('<select id="showlist_selection" onChange="setSelectedList();">');
      	for (var s_list in testsShowLists) {
      		document.write("<option value='"+s_list+"'>"+s_list);
      	}
      	// document.write("<option value='m1'>Custom");
      	document.write('</select>');
      	setSelectedList();
      	document.write('<label>Folders:</label>');
      	document.write('<select id="folders_selection" onChange="setSelectedFoldersList();">');
      	for (var s_list in foldersShowLists) {
      		document.write("<option value='"+s_list+"'>"+s_list);
      		
      	}
      	// document.write("<option value='m1'>Custom");
      	document.write('</select>');
      	setSelectedFoldersList();
      }
      
      function showSlideShowList(list)
      {
      	s_list = document.getElementById("slideshow_list");
      	if (s_list && testsShowLists && testsShowLists[list]) {
      		s_list.innerHTML = "";
      		s = "";
      		s += '<table width=100%>';
      		if (list == "Custom") {
      			s += "<tr><td><input type=button name=\"clear\" value=\"Clear\" onclick=\"clearShowList('Custom');\"></td></tr>";
      		}		
      		sList = testsShowLists[list];
      		ctrlStr = "";
      		for (var i=0; i< sList.length; i++) {
      			if (list == "Custom") {
      				ctrlStr = "<a class='remove_from_list' href='' onClick='removeFromTestsShowList(\"Custom\",\""+i+"\");'>[x]</a>"
      			}
      			s += '<tr><td id="ssid_'+i+'">'+ctrlStr+sList[i][1]+'</td></tr>';
      		}
      		s += '</table>';
      		s_list.innerHTML = s;
      		// select("ssid_0", false, 5);
      	}
      }
      
      function removeFromTestsShowList(list, idx)
      {
      	if (testsShowLists && testsShowLists[list]) {
      		testsShowLists[list].splice(idx,1);
      		showSlideShowList(list);
      	}
      }
      
      function addToTestsShowList(list, testID, testName, scope)
      {
      	var inList = false;
      	if (testsShowLists) {
      		var entry = new Array();
      		entry[0]=testID;
      		entry[1]=testName;
      		entry[2]=scope;
      		if (!testsShowLists[list]) testsShowLists[list] = new Array();
      		sList = testsShowLists[list];
      		for (var i=0; i<sList.length; i++) {			
      			if (sList[i][0] == testID) inList = true;
      		}
      		if (!inList) sList.push(entry);
      	}
      	if (list == "Custom") showSlideShowList(list);
      }
      
      function addToFoldersShowList(list, folderID, folderName)
      {
      	var inList = false;
      	if (foldersShowLists) {
      		var entry = new Array();
      		entry[0]=folderID;
      		entry[1]=folderName;
      		
      		if (!foldersShowLists[list]) foldersShowLists[list] = new Array();
      		sList = foldersShowLists[list];
      		for (var i=0; i<sList.length; i++) {			
      			if (sList[i][0] == folderID) inList = true;
      		}
      		if (!inList) sList.push(entry);
      	}
      //	if (list == "Custom") showSlideShowList(list);
      }
      
      function clearShowList(id, list)
      {
      	if (id == "Tests") {
      		if (testsShowLists && testsShowLists[list]) { 
      			testsShowLists[list].length = 0;
      			showSlideShowList(list);
      		}
      	} else if (id == "Folders") {
      		if (foldersShowLists && foldersShowLists[list]) { 
      			foldersShowLists[list].length = 0;
      			// showSlideShowList(list);
      		}
      	}
      	
      }
      
      function setupFilters()
      {
      	// "test_type_filter"
      	// "problem_severity_filter"
      	
      	if (TESTS_MAP && TESTS_MAP.bindings.length) {
      		test_type_filter = document.getElementById("test_type_filter");
      					
      		if (test_type_filter) {
      			test_type_filter.options.length = 0;
      			var isSelected = false;
      		
      			try {						
      				test_type_filter.add(new Option("No Filter", "NONE", false, isSelected), null);
      				test_type_filter.add(new Option("Custom Filter", "CUSTOM", false, isSelected), null);
      			}
      			catch(e){ //in IE, try the below version instead of add()
      				test_type_filter.add(new Option("No Filter", "NONE", test_type, false, isSelected));
      				test_type_filter.add(new Option("Custom Filter", "CUSTOM", test_type, false, isSelected));
      			}
      			test_type_filter.options[0].title = "No Filter";
      			test_type_filter.options[1].title = "Custom Filter";
      			
      			for (var i = 0; i < TESTS_MAP.bindings.length; i++) {
      				map_entry = TESTS_MAP.bindings[i];
      				if (map_entry && map_entry.testID ) { 
      					test_type = map_entry.testID;
      					try {						
      						test_type_filter.add(new Option(test_type, test_type, false, isSelected), null); //add new option to end of "sample"					
      					}
      					catch(e){ //in IE, try the below version instead of add()
      						test_type_filter.add(new Option(test_type, test_type, false, isSelected));
      					}
      					test_type_filter.options[test_type_filter.options.length-1].title = test_type;
      				}
      			}
      			
      		}
      	}
      	
      	if (DQM_SEVERITY && DQM_SEVERITY.length) {
      		severity_filter = document.getElementById("problem_severity_filter");
      					
      		if (severity_filter) {
      			severity_filter.options.length = 0;
      			var isSelected = false;
      			try {						
      					severity_filter.add(new Option("No Filter", "NONE", false, true), null);
      					// severity_filter.add(new Option("Custom Filter", "CUSTOM", false, isSelected), null);
      				}
      			catch(e){ //in IE, try the below version instead of add()
      					severity_filter.add(new Option("No Filter", "NONE", false, true));
      					// severity_filter.add(new Option("Custom Filter", "CUSTOM", false, isSelected));
      			}
      			severity_filter.options[0].title = "No Filter";
      			// severity_filter.options[1].title = "Custom Filter";
      			for (var i = 1; i < DQM_SEVERITY.length-4; i++) {
      				entry = DQM_SEVERITY[i];
      				if (entry && entry.name ) { 
      					severity = entry.name;
      					try {						
      						severity_filter.add(new Option(severity, severity, false, isSelected), null);
      						
      					}
      					catch(e){ //in IE, try the below version instead of add()
      						severity_filter.add(new Option(severity, severity, false, isSelected));						
      					}
      					severity_filter.options[severity_filter.options.length-1].title = entry.descr;
      				}
      			}
      			
      		}
      	}
      	
      }
      
      
      function setTestTypeFilter()
      {
      	var selObj = document.getElementById("test_type_filter");
      	if (selObj) {
      		var selIdx = selObj.selectedIndex;
      		selTestTypeFilter = selObj.options[selIdx].value;		
      		addlog(selTestTypeFilter, "debug");
      		// getRefDQMReport(selRefRun);
      	}
      }
      		
      function setProblemSeverityFilter()
      {
      	var selObj = document.getElementById("problem_severity_filter");
      	if (selObj) {
      		var selIdx = selObj.selectedIndex;
      		selSeverityFilter = selObj.options[selIdx].value;	
      		
      		// addlog(selSeverityFilter, "debug");
      		loadDQMReport("report_div", DQM_REPORT);
      		// getRefDQMReport(selRefRun);
      	}
      }
      
      
      function setSelectedTab(obj)
      {
         o_selected = get_element("selected");
         if (o_selected) {
      	o_selected.id = '';
         }
         
         obj.id = "selected";  
      
         if (obj.title == "csc_view") {
      	div_obj = get_element("csctable_div");
      	div_obj.style.display = "";
      	div_obj = get_element("hwtable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("ddutable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("report_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("csccounters_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("known_problems_div");
      	div_obj.style.display = "none";
         }
         else if (obj.title == "hw_view") {
      	div_obj = get_element("csctable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("hwtable_div");
      	div_obj.style.display = "";
      	div_obj = get_element("ddutable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("report_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("csccounters_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("known_problems_div");
      	div_obj.style.display = "none";
         }
         else if (obj.title == "ddu_view") {
      	div_obj = get_element("csctable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("hwtable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("ddutable_div");
      	div_obj.style.display = "";
      	div_obj = get_element("report_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("csccounters_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("known_problems_div");
      	div_obj.style.display = "none";
         }
         else if (obj.title == "report_view") {
      	div_obj = get_element("csctable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("hwtable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("ddutable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("report_div");
      	div_obj.style.display = "";
      	div_obj = get_element("csccounters_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("known_problems_div");
      	div_obj.style.display = "none";
         }
         else if (obj.title == "csccounters_view") {
      	div_obj = get_element("csctable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("hwtable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("ddutable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("report_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("csccounters_div");
      	div_obj.style.display = "";
      	div_obj = get_element("known_problems_div");
      	div_obj.style.display = "none";
         }
         else if (obj.title == "known_problems_view") {
      	div_obj = get_element("csctable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("hwtable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("ddutable_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("report_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("csccounters_div");
      	div_obj.style.display = "none";
      	div_obj = get_element("known_problems_div");
      	div_obj.style.display = "";
         }
         return false;
      }
      
      function setSelectedRunsTab(obj)
      {
         o_selected = get_element("selected_runs");
         if (o_selected) {
      	o_selected.id = '';
         }
         obj.id = "selected_runs";
         if (obj.title == "local") {
      	div_obj = get_element("local_runs");
      	div_obj.style.display = "";
      	div_obj = get_element("global_runs");
      	div_obj.style.display = "none";
      	div_obj = get_element("online_runs");
      	div_obj.style.display = "none";
         }
         else if (obj.title == "global") {
      	div_obj = get_element("local_runs");
      	div_obj.style.display = "none";
      	div_obj = get_element("global_runs");
      	div_obj.style.display = "";
      	div_obj = get_element("online_runs");
      	div_obj.style.display = "none";
         }else if (obj.title == "online") {
      	div_obj = get_element("local_runs");
      	div_obj.style.display = "none";
      	div_obj = get_element("global_runs");
      	div_obj.style.display = "none";
      	div_obj = get_element("online_runs");
      	div_obj.style.display = "";
         }
         obj.id = "selected";
         o_selected = obj;
         return false;
      }
      
      get_element = document.all ?
      	function (s_id) { return document.all[s_id] } :
      	function (s_id) { if (s_id != "") { return document.getElementById(s_id) } else {return null} };
      
function showChart()
{
   var chart = new Highcharts.Chart({
	chart: {
		renderTo: 'plots_div'
	},

	xAxis: {
		categories: ['Jan', 'Feb', 'Mar']
	},

	series: [{
		data: [29.9, 71.5, 106.4]
	}]
  
   });
}

    </script>
  </head>
  <body>
    <!--script src="redir?url=highcharts/adapters/standalone-framework.js"></script>
    <script src="redir?url=highcharts/highcharts.js"></script>
    <script src="redir?url=highcharts/modules/exporting.js"></script-->
    <script type="text/javascript">
      if (navigator.userAgent.toLowerCase().indexOf('msie') != -1) isIE=true;
      baseURL=document.URL;
      if (document.URL.lastIndexOf('/') != document.URL.length-1) baseURL+="/";
      document.write('<script src="', baseURL+CSCMap, '" type="text/javascript"><\/script>');
      // document.write('<script src="', baseURL+RunsList, '" type="text/javascript"><\/script>');
      document.write('<script src="', baseURL+TestsList, '" type="text/javascript"><\/script>');
      document.write('<script src="', baseURL+DDUMap, '" type="text/javascript"><\/script>');
      document.write('<script src="', baseURL+VMEMap, '" type="text/javascript"><\/script>');
      document.write('<script src="', baseURL+TestsMap, '" type="text/javascript"><\/script>');
      document.write('<script src="', baseURL+KnownProblemsList, '" type="text/javascript"><\/script>');
      // document.write('<script src="', baseURL+NodesStatsFile, '" type="text/javascript"><\/script>');
      document.write('<script src="', baseURL+"redir?url=highcharts/adapters/standalone-framework.js", '" type="text/javascript"><\/script>');
      document.write('<script src="', baseURL+"redir?url=highcharts/highcharts.js", '" type="text/javascript"><\/script>');
      document.write('<script src="', baseURL+"redir?url=highcharts/modules/exporting.js", '" type="text/javascript"><\/script>');
      //-->
    </script>
    
    <table  class='page_layout' style='border: 0px black solid;'>
      <tr style='border: 0px black solid;'>
        <td style='border: 0px black solid;'>
          <fieldset id="DQMControl" title='DQM Run Control action buttons'>
            <legend>
              <a class='winTitle' href='#' onClick='showHide("dqm_control");'>DQM Control</a>
            </legend>
            <div id="dqm_control">
              <table>
                <tr>
                  <td>	
                    <input class="button" type="button" name="action" style="background-color: #ffff90; font: bold 12px Arial;" value="Init" onClick="return sendDQMAction('Configure');"  title='Click to Initialize and Configure DQM Monitors'>
                    <input class="button" type="button" name="action" style="background-color: #90ff90; font: bold 12px Arial;" value="Start" onClick="return sendDQMAction('Enable');" title='Click to Start DQM Monitors to get data from DAQ'>
                    <input class="button" type="button" name="action" style="background-color: #ff9090; font: bold 12px Arial;" value="Stop" onClick="return sendDQMAction('Halt');" title='Click to Stop DQM Monitors and to force saving of current DQM results'>
                  </td>
                  <td align='right'><input class="button" type="button" name="action" style="background-color: lightblue; font: bold 12px Arial;" value="Reset Display" onClick="return sendDisplayAction('reset');"  title='Click to send Reset command to DQM Display'></td>
                </tr>
              </table>
            </div>
          </fieldset>
          <fieldset id="Runs" title='List of available for browsing Runs'>
            <legend>
              <a class='winTitle' href='#' onClick='showHide("runs_list");'>Runs</a>
            </legend>
            <a target="_blank" href=http://csc-c2d08-13.cms:20560/urn:xdaq-application:lid=1451/><b><font color="red" size="2">Browse results from old DQM node</font></b></a>
            <div id="runs_list">
            </div>
            <div id="run_filter" title="Runs fitering">
              <script type="text/javascript">
                <!--//
                  setRunsFilter();
                  //-->
              </script>
            </div>
            <div id="compare_list" title="Compare selected Run DQM Results to other Runs">	
              <label>Compare to:</label>
              <select id="compare_selection" onChange="setCompareRun();">
              </select><br>
              <span title='Check to Enable DDUs Comparison'><label>DDUs Comparison</label> <input type=checkbox  id="dducompare" onclick="selectCompareDDUMode();"></span><br>
              <span title='Check to Show Known Problems'><label>Show Known Problems</label> <input checked type=checkbox  id="showknown" onclick="selectShowKnownMode();"></span><br>
              <span title='Check to Mark Low Stats Errors'><label>Mark Low Stats Errors</label> <input checked type=checkbox  id="marklowstats" onclick="selectMarkLowStatsErrs();"></span><br>
            </div>
            <div title="Display Filters for DQM Reports">
              <span title="Select Problem Severity Level Filter">
              <label>Problem Severity Filter:</label>
              <select  id="problem_severity_filter" onChange="setProblemSeverityFilter();"></select>
              </span><!--br>
                <span title="Select Problem/Test Type Filter">
                <label>Problem Types Filter:</label><br>
                <select  id="test_type_filter" onChange="setTestTypeFilter();"></select>
                </span-->
              <script type="text/javascript">			
                <!--//
                  // setSelectedResultsFolder();
                  setupFilters();
                  //-->
              </script>
            </div>
            <script type="text/javascript">			
              <!--//
                // setSelectedResultsFolder();
                getRunsList();
                //-->
            </script>
          </fieldset>
          <fieldset id="Tests" title='List of available for browsing Tests/Canvases'>
            <legend>
              <a class='winTitle' href='' onClick='return showHide("tests_div");'>Tests</a>
            </legend>
            <div id="tests_div">
              <script type="text/javascript">
                <!--//
                  loadCSCList();
                  loadTestsList (TREE_ITEMS, "tests_div");
                  
                  //-->
              </script>
            </div>
          </fieldset>
          <fieldset id="Options" title='Plots displaying optons'>
            <legend><a class='winTitle' href='' onClick='return showHide("options_div");'>Options</a></legend>
            <div id="options_div">
              <table>
                <tr>
                  <td>
                    <span title='Change Displayed Plots Width in pixels'>
                      <label>Plot Width:</label> 
                      <input type=button name="decWidth" value="-" onclick="decImageWidth();">    		     
                      <script type="text/javascript"> 
                        document.write("<input type=text readonly id='imageWidth' align=right value='"+imgWidth+"' size='4'>"); 		 
                      </script>
                      <input type=button name="incWidth" value="+" onclick="incImageWidth()">    
                    </span>
                  </td>
                </tr>
                <tr>
                  <td>
                    <span title='Change Displayed Plots Height in pixels'>
                      <label>Plot Height:</label> 
                      <input type=button name="decHeight" value="-" onclick="decImageHeight();">    		     
                      <script type="text/javascript"> 
                        document.write("<input type=text readonly id='imageHeight' align=right value='"+imgHeight+"' size='4'>"); 		 
                      </script>
                      <input type=button name="incHeight" value="+" onclick="incImageHeight()">
                    </span>
                  </td>
                </tr>
                <tr>
                  <td>
                    <span title='Show Plots in External Window'><label>Open in External Window</label></label> <input type=checkbox  id="openExternal" onclick="selectPlotMode()"></span>  
                  </td>
                </tr>
                <tr>
                  <td>
                    <span title='Switch Display of Reference Plots'><label>Show Reference Plots</label></label> <input type=checkbox  id="showReference" onclick="selectShowReferenceMode()"></span>  
                  </td>
                </tr>
                <tr>
                  <td>
                    <span title='Switch Plots Auto-Updating'><label>Auto Update</label></label> <input type=checkbox  id="autoUpdateMode" onclick="selectUpdateMode()"></span>  
                  </td>
                </tr>
              </table>
            </div>
          </fieldset>
          <fieldset id="SlideShow" title='Plots slide-show control and options'>
            <legend><a class='winTitle' href='' onClick='return showHide("slideshow_div");'>SlideShow</a></legend>
            <div id="slideshow_div">
              <form name="theTimer">
                <table>
                  <tr>
                    <td colspan=3>
                      <script type="text/javascript">
                        <!--//
                          initSlideShowList();
                          
                          //-->
                        	
                      </script>
                    </td>
                  </tr>
                  <tr>
                    <td colspan=3 align=center>
                      <!-- input type=text name="currentTest" -->
                      <span id="currentTest"></span>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <input type=button name="prev" value="<" onclick="showPrevSlide()">    
                      <input type=button name="start" value="Start" onclick="startSlideShow()">      
                      <input type=button name="stop" value="Stop" onclick="stopSlideShow()">
                      <input type=button name="reset" value="Reset" onclick="resetSlideShow()">
                      <input type=button name="next" value=">" onclick="showNextSlide()">    
                      <input type=text id="updateInterval" value="5" size="2"> 		 
                    </td>
                  </tr>
                </table>
              </form>
              <div id="slideshow_list">
              </div>
            </div>
          </fieldset>
        </td>
        <td style='border: 0px black solid;'>
          <fieldset id="NodesView" title='DQM Monitor Nodes status view'>
            <legend>
              <a class='winTitle' href='' onClick='return showHide("nodes_div");'>Nodes Status</a>						
            </legend>
            <div id="nodes_div">
              <div id="nodesview_div">
                <script type="text/javascript">
                  <!--//
                    getNodesList();					
                    //-->
                </script>
              </div>
              <div id='sysstatus_div'>
                <script type="text/javascript">
                  <!--//
                    updateSysStatus();					
                    //-->
                </script>
              </div>
              <div id='nodestatus_div' style='display:none'></div>
            </div>
          </fieldset>
          <fieldset id="SystemView" title='EMU System Views'>
            <legend>
              <a class='winTitle' href='' onClick='return showHide("sysview_div");'>System View</a>
            </legend>
            <div id="sysview_div">
              <div class="tabs">
                <ul>
                  <li title="csc_view" id="selected" onClick="return setSelectedTab(this);"><a href="" title="CSC View Table">CSCs Table</a></li>
                  <li title="hw_view" onClick="return setSelectedTab(this);"><a href="" title="VME Crate/DMB Slot View Table">VME/DMB Table</a></li>
                  <li title="ddu_view"  onClick="return setSelectedTab(this);"><a href="" title="DDU to CSC Mapping">DDU/CSC Map</a></li>
                  <li title="csccounters_view"  onClick="return setSelectedTab(this);"><a href="" title="CSC Efficiencies Counters">CSC Counters</a></li>
                  <li title="report_view"  onClick="return setSelectedTab(this);"><a href="" title="DQM Quality Checks Summary Report">Summary Report</a></li>
                  <li title="known_problems_view"  onClick="return setSelectedTab(this);"><a href="" title="DQM Known and Acknowledged Problems">Known Problems</a></li>
                </ul>
              </div>
              <div id="csctable_div" >
                <script type="text/javascript">
                  <!--//
                    // new showCSCTable("csctable_div");
                    showCSCTable("csctable_div");					
                    //-->
                </script>
              </div>
              <div id="hwtable_div" style="display: none;">
                Empty HW Table
              </div>
              <div id="ddutable_div" style="display: none;">
                <script type="text/javascript">
                  <!--//
                    // new showCSCTable("csctable_div");
                    showDDUTable("ddutable_div");
                    //-->
                </script>
              </div>
              <div id="csccounters_div" style="display: none;">
                <script type="text/javascript">
                  <!--//
                    getCSCCounters();
                    //-->
                </script>
              </div>
              <div id="nodes_div" style="display: none;">
                Empty
              </div>
              <div id="report_div" style="display: none;">
                <script type="text/javascript">
                  <!--//
                    getDQMReport();
                    //-->
                </script>				
              </div>
              <div id="known_problems_div" style="display: none;">
                <script type="text/javascript">
                  <!--//
                    loadKnownProblems("known_problems_div", KNOWN_PROBLEMS);
                    //-->
                </script>				
              </div>
            </div>
          </fieldset>
          <fieldset id="StatusEntry" title="Report Entry">
            <legend><a id='report_title' class='winTitle' href='#' onClick='showHide("report_entry_div");'>Report Status</a></legend>
            <div id="report_entry_div">		
            </div>
          </fieldset>
          <fieldset id="Plots" title="Plots Display Windows">
            <legend><a id='plot_title' class='winTitle' href='' onClick='return showHide("plots_div");'>Plots</a></legend>
            <div id="plots_div">
		<script type="text/javascript">
                  <!--//
		    // showChart();
                    //-->
                </script>
            </div>
          </fieldset>
        </td>
      </tr>
      <tr style='border: 0px black solid;'>
        <td colspan=2 style='border: 0px black solid; display:none;'>
          <fieldset title="Log Window">
            <legend>
              <a class='winTitle' href='' onClick='return showHide("log");'>Log</a>
              <input type=button value="Clear" onclick="clearLog();"> 
              <select id="selLogLevel" onChange="selectLogLevel()";>
                <option selected value="all">ALL</option>
                <option value="debug">DEBUG</option>
                <option value="info">INFO</option>
                <option value="warn">WARNING</option>
                <option value="error">ERROR</option>
              </select>
            </legend>
            <table>
              <div id="log">
              </div>
            </table>
          </fieldset>
        </td>
      </tr>
    </table>
  </body>
</html>
